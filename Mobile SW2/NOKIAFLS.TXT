
Hi,

Here come the algorithm for calculate the "FlashAuthorityID"
This is necessary after flashing Nokia phones with other version/PPM language
to update the 'EEPROM area'. In this way the phone will LOG (find) the network.
Sorry, this is only for smart guys now.
Soon will be available software who can update phone EEPROM after flashing.
And this will be released for free, even if in last 3 years I sell all 
my production hardware/software ;)

The inputs for this algorithm are:
 - 13 bytes Phone MSID
 - Checksum of flash parts
The output are:
 - 12 bytes "Flash_Authority_ID"

This is only a first 'small' release.
Soon will come more:
 - how to stop counter in FLS-1 and FLS-2 original Nokia flashing devices
   (Wintesla DLL's patches)
 - how to make your own FLS-1 device using an DK2 dongle
   (anybody can order this from WWW.DESKEY.CO.UK for less money)
 - M2BUS commands related to "Flash_Authority_ID" and MSID
 - Software who automaticaly update "EEPROM" with calculated value


Best regards,
Zulea




;
; ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
; º     This file is generated by The Interactive Disassembler (IDA)        º
; º     Copyright (c) 1999 by DataRescue sa/nv, <ida@datarescue.com>        º
; ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
;
; 
; External Entry #827542598 into the Module
; Attributes (0003): Moveable Exported Shared dataseg
; 

; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U B	R O U T	I N E ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ

; Attributes: bp-based frame

		public FLS1GETAUTHORITYID
FLS1GETAUTHORITYID proc	far

var_118		= byte ptr -118h
var_117		= byte ptr -117h
var_14		= word ptr -14h
var_12		= word ptr -12h
var_E		= word ptr -0Eh
var_C		= word ptr -0Ch
var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah
arg_6		= word ptr  0Ch
arg_8		= word ptr  0Eh
arg_A		= word ptr  10h
arg_C		= byte ptr  12h
arg_E		= byte ptr  14h

		enter	118h, 0		; FLS1WN16_7
		push	di
		push	si
		push	ds
		mov	ax, seg	dseg06
		mov	ds, ax
		sub	ax, ax
		mov	[bp+var_A], ax
		mov	[bp+var_C], ax
		mov	[bp+var_8], 64h	; 'd'
		mov	[bp+var_6], ax
		mov	ax, seg	cseg02
		push	ds
		lea	di, [bp+var_118]
		mov	si, 0B7Eh
		push	ss
		pop	es
		mov	ds, ax
		assume ds:cseg02
		movsb
		pop	ds
		assume ds:dseg06
		xor	ax, ax
		mov	cx, 81h	; ''
		lea	di, [bp+var_117]
		repe stosw
		stosb
		cmp	word_FA8_12, ax
		jnz	loc_B99_79F
		mov	ax, 0Fh

FailExit1:				; CODE XREF: FLS1GETAUTHORITYID+70j
		xor	dx, dx
		jmp	FailExitEnd
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_B99_79F:				; CODE XREF: FLS1GETAUTHORITYID+3Dj
		lea	ax, [bp+var_14]
		push	ss
		push	ax
		call	FLS1GETLICENCECOUNT
		mov	[bp+var_4], ax
		mov	[bp+var_2], dx
		or	dx, ax
		jz	loc_B99_7B9
		mov	dx, [bp+var_2]
		jmp	FailExitEnd
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_B99_7B9:				; CODE XREF: FLS1GETAUTHORITYID+59j
		cmp	[bp+var_12], 0
		jnz	loc_B99_7CA
		cmp	[bp+var_14], 1
		jnb	loc_B99_7CA
		mov	ax, 3
		jmp	short FailExit1
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_B99_7CA:				; CODE XREF: FLS1GETAUTHORITYID+65j
					; FLS1GETAUTHORITYID+6Bj
		mov	di, [bp+arg_6]
		push	40h ; '@'
		lea	ax, [di+3]
		push	0
		push	ax
		call	GLOBALALLOC
		push	ax
		call	GLOBALLOCK
		mov	si, ax
		mov	[bp+var_E], dx
		or	dx, ax
		jnz	loc_B99_7EC
		jmp	loc_B99_881
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_B99_7EC:				; CODE XREF: FLS1GETAUTHORITYID+8Fj
		mov	es, [bp+var_E]
		mov	byte ptr es:[si], 1
		mov	al, [bp+arg_E]
		mov	es:[si+1], al
		mov	al, [bp+arg_C]
		mov	es:[si+2], al
		push	di
		push	[bp+arg_A]
		push	[bp+arg_8]
		lea	ax, [si+3]
		push	es
		push	ax
		call	_memcpy
		add	sp, 0Ah
		push	[bp+arg_0]
		push	[bp+arg_4]
		push	[bp+arg_2]
		lea	ax, [di+3]
		push	ax
		push	[bp+var_E]
		push	si
		push	seg cseg02
		push	offset aNk	; "NK"
		push	word_FA8_10
		call	sub_0_D8
		add	sp, 12h
		push	ax
		call	sub_B99_3A
		pop	bx
		mov	[bp+var_4], ax
		mov	[bp+var_2], dx
		cmp	ax, 14h
		jnz	loc_B99_853
		or	dx, dx
		jnz	loc_B99_853
		mov	[bp+var_4], 4

loc_B99_853:				; CODE XREF: FLS1GETAUTHORITYID+F0j
					; FLS1GETAUTHORITYID+F4j
		mov	ax, dx
		or	ax, [bp+var_4]
		jnz	loc_B99_862
		sub	[bp+var_14], 1
		sbb	[bp+var_12], 0

loc_B99_862:				; CODE XREF: FLS1GETAUTHORITYID+100j
		mov	ax, [bp+var_E]
		push	ax
		mov	si, ax
		call	GLOBALHANDLE
		push	ax
		call	GLOBALUNLOCK
		push	si
		call	GLOBALHANDLE
		push	ax
		call	GLOBALFREE
		jmp	short loc_B99_88B
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_B99_881:				; CODE XREF: FLS1GETAUTHORITYID+91j
		mov	[bp+var_4], 9
		mov	[bp+var_2], 0

loc_B99_88B:				; CODE XREF: FLS1GETAUTHORITYID+127j
		lea	ax, [bp+var_118]
		push	ss
		push	ax
		push	104h
		call	GETWINDOWSDIRECTORY
		or	ax, ax
		jz	loc_B99_8FD
		lea	ax, [bp+var_118]
		push	ss
		push	ax
		call	_strlen
		add	sp, 4
		mov	si, ax
		cmp	[bp+si+var_118], 5Ch ; '\'
		jz	loc_B99_8C8
		push	seg cseg02
		push	offset asc_B99_FF4 ; "\\"
		lea	ax, [bp+var_118]
		push	ss
		push	ax
		call	_strcat
		add	sp, 8

loc_B99_8C8:				; CODE XREF: FLS1GETAUTHORITYID+15Aj
		push	seg cseg02
		push	offset aFls1_ini ; "FLS1.INI"
		lea	ax, [bp+var_118]
		push	ss
		push	ax
		call	_strcat
		add	sp, 8
		push	seg cseg02
		push	offset aFls1	; "FLS-1"
		push	seg cseg02
		push	offset aLicencewarning ; "LicenceWarningLevel"
		push	64h ; 'd'
		lea	ax, [bp+var_118]
		push	ss
		push	ax
		call	GETPRIVATEPROFILEINT
		mov	[bp+var_8], ax
		mov	[bp+var_6], 0

loc_B99_8FD:				; CODE XREF: FLS1GETAUTHORITYID+143j
		mov	ax, [bp+var_14]
		mov	dx, [bp+var_12]
		cmp	[bp+var_6], dx
		jb	loc_B99_919
		ja	loc_B99_90F
		cmp	[bp+var_8], ax
		jb	loc_B99_919

loc_B99_90F:				; CODE XREF: FLS1GETAUTHORITYID+1B0j
		mov	[bp+var_C], 0
		mov	[bp+var_A], 8000h

loc_B99_919:				; CODE XREF: FLS1GETAUTHORITYID+1AEj
					; FLS1GETAUTHORITYID+1B5j
		mov	ax, [bp+var_C]
		mov	dx, [bp+var_A]
		or	ax, [bp+var_4]
		or	dx, [bp+var_2]

FailExitEnd:				; CODE XREF: FLS1GETAUTHORITYID+44j
					; FLS1GETAUTHORITYID+5Ej
		pop	ds
		pop	si
		pop	di
		leave
		retf	10h
FLS1GETAUTHORITYID endp

; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U B	R O U T	I N E ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ

; Attributes: bp-based frame

Calculate_FlshAuthID proc far		; CODE XREF: FLS1GETAUTHORITYID+D8P

var_34		= byte ptr -34h
var_18		= byte ptr -18h
var_C		= byte ptr -0Ch
var_A		= byte ptr -0Ah
var_9		= byte ptr -9
var_8		= byte ptr -8
var_7		= byte ptr -7
var_5		= byte ptr -5
var_4		= word ptr -4
var_1		= byte ptr -1
arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah
arg_6		= word ptr  0Ch
arg_8		= word ptr  0Eh
arg_A		= word ptr  10h
arg_C		= dword	ptr  12h
arg_10		= word ptr  16h

		enter	34h, 0
		push	di
		push	si
		mov	si, [bp+arg_0]
		mov	di, [bp+arg_2]
		push	0
		push	0
		push	[bp+arg_4]
		push	di
		push	si
		push	cs
		call	near ptr sub_0_14
		add	sp, 0Ah
		mov	[bp+var_1], al
		cmp	al, 68h	; 'h'
		jnz	loc_0_11E
		push	[bp+arg_10]
		push	word ptr [bp+arg_C+2]
		push	word ptr [bp+arg_C]
		push	[bp+arg_A]
		push	[bp+arg_8]
		push	[bp+arg_6]
		push	[bp+arg_4]
		push	di
		push	si
		call	Calc_FlshAuthID_sub
		add	sp, 12h
		pop	si
		pop	di
		leave
		retf
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_11E:				; CODE XREF: Calculate_FlshAuthID+21j
		cmp	[bp+var_1], 69h	; 'i'
		jz	loc_0_132
		cmp	[bp+var_1], 6Ch	; 'l'
		jz	loc_0_132
		mov	al, [bp+var_1]
		pop	si
		pop	di
		leave
		retf
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
		db  90h	; 
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_132:				; CODE XREF: Calculate_FlshAuthID+4Aj
					; Calculate_FlshAuthID+50j
		cmp	[bp+arg_A], 1
		jnb	loc_0_13B
		jmp	loc_0_236
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_13B:				; CODE XREF: Calculate_FlshAuthID+5Ej
		cmp	[bp+arg_A], 1Ch
		jbe	loc_0_144
		jmp	loc_0_236
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_144:				; CODE XREF: Calculate_FlshAuthID+67j
		cmp	[bp+arg_10], 0Ch
		jbe	loc_0_14D
		jmp	loc_0_236
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_14D:				; CODE XREF: Calculate_FlshAuthID+70j
		mov	ax, [bp+arg_8]
		or	ax, [bp+arg_6]
		jnz	loc_0_158
		jmp	loc_0_236
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_158:				; CODE XREF: Calculate_FlshAuthID+7Bj
		mov	ax, word ptr [bp+arg_C+2]
		or	ax, word ptr [bp+arg_C]
		jnz	loc_0_163
		jmp	loc_0_236
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_163:				; CODE XREF: Calculate_FlshAuthID+86j
		mov	ax, [bp+arg_6]
		mov	dx, [bp+arg_8]
		mov	cx, [bp+arg_A]
		push	ds
		lea	di, [bp+var_34]
		mov	si, ax
		push	ss
		pop	es
		mov	ds, dx
		shr	cx, 1
		repe movsw
		adc	cx, cx
		repe movsb
		pop	ds
		cmp	[bp+var_1], 6Ch	; 'l'
		jnz	loc_0_1B8
		push	0
		push	1
		lea	ax, [bp+var_A]
		push	ss
		push	ax
		call	sub_0_1458
		add	sp, 8
		call	sub_0_1410
		xor	al, 1
		mov	[bp+var_5], al
		mov	di, 6
		xor	si, si
		mov	[bp+var_4], di

loc_0_1A8:				; CODE XREF: Calculate_FlshAuthID+DCj
		call	sub_0_1410
		xor	[bp+si+var_34],	al
		inc	si
		cmp	si, 1Ch
		jb	loc_0_1A8
		jmp	short loc_0_1CB
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_1B8:				; CODE XREF: Calculate_FlshAuthID+ABj
		mov	[bp+var_A], 0Dh
		mov	[bp+var_8], 0
		mov	al, 1
		mov	[bp+var_9], al
		mov	[bp+var_7], al
		mov	di, 4

loc_0_1CB:				; CODE XREF: Calculate_FlshAuthID+DEj
		push	[bp+arg_0]
		push	[bp+arg_4]
		push	[bp+arg_2]
		lea	ax, [bp+var_A]
		push	ss
		push	ax
		push	di
		lea	ax, [bp+var_34]
		push	ss
		push	ax
		push	1Ch
		lea	ax, [bp+var_18]
		push	ss
		push	ax
		push	0Dh
		push	1
		call	AdrProc_DK2SendAndReceive
		call	AdrProc_DK2Success
		or	ax, ax
		jnz	loc_0_1FC
		mov	al, 66h	; 'f'
		pop	si
		pop	di
		leave
		retf
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_1FC:				; CODE XREF: Calculate_FlshAuthID+11Cj
		cmp	[bp+var_1], 6Ch	; 'l'
		jnz	loc_0_212
		xor	si, si

loc_0_204:				; CODE XREF: Calculate_FlshAuthID+138j
		call	sub_0_1410
		xor	[bp+si+var_18],	al
		inc	si
		cmp	si, 0Dh
		jb	loc_0_204

loc_0_212:				; CODE XREF: Calculate_FlshAuthID+128j
		cmp	[bp+arg_10], 0
		jz	loc_0_22F
		mov	cx, [bp+arg_10]
		push	ds
		lea	si, [bp+var_18]
		mov	ax, ss
		mov	ds, ax
		les	di, [bp+arg_C]
		shr	cx, 1
		repe movsw
		adc	cx, cx
		repe movsb
		pop	ds

loc_0_22F:				; CODE XREF: Calculate_FlshAuthID+13Ej
		mov	al, [bp+var_C]
		pop	si
		pop	di
		leave
		retf
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_236:				; CODE XREF: Calculate_FlshAuthID+60j
					; Calculate_FlshAuthID+69j ...
		mov	al, 65h	; 'e'
		pop	si
		pop	di
		leave
		retf
Calculate_FlshAuthID endp

; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U B	R O U T	I N E ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ

; Attributes: bp-based frame

Calc_FlshAuthID_sub_1 proc far		; CODE XREF: Calculate_FlshAuthID+3AP

var_3C		= byte ptr -3Ch
var_2E		= byte ptr -2Eh
var_2D		= byte ptr -2Dh
var_2C		= byte ptr -2Ch
var_1E		= byte ptr -1Eh
var_1D		= byte ptr -1Dh
var_1C		= byte ptr -1Ch
var_10		= byte ptr -10h
var_E		= byte ptr -0Eh
var_D		= byte ptr -0Dh
var_C		= word ptr -0Ch
var_A		= word ptr -0Ah
var_8		= word ptr -8
var_6		= word ptr -6
var_4		= word ptr -4
var_2		= word ptr -2
arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= word ptr  0Ah
arg_6		= word ptr  0Ch
arg_8		= word ptr  0Eh
arg_A		= word ptr  10h
arg_C		= dword	ptr  12h
arg_10		= word ptr  16h

		enter	3Ch, 0
		push	di
		push	si
		mov	di, [bp+arg_A]
		mov	ax, 0FC00h
		mov	[bp+var_C], ax
		mov	[bp+var_A], ax
		mov	[bp+var_8], ax
		cmp	di, 1
		jnb	loc_0_1023
		jmp	loc_0_1186
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_1023:				; CODE XREF: Calc_FlshAuthID_sub_1+18j
		cmp	di, 1Ch
		jbe	loc_0_102B
		jmp	loc_0_1186
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_102B:				; CODE XREF: Calc_FlshAuthID_sub_1+20j
		cmp	[bp+arg_10], 0Ch
		jbe	loc_0_1034
		jmp	loc_0_1186
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_1034:				; CODE XREF: Calc_FlshAuthID_sub_1+29j
		mov	ax, [bp+arg_8]
		or	ax, [bp+arg_6]
		jnz	loc_0_103F
		jmp	loc_0_1186
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_103F:				; CODE XREF: Calc_FlshAuthID_sub_1+34j
		mov	ax, word ptr [bp+arg_C+2]
		or	ax, word ptr [bp+arg_C]
		jnz	loc_0_104A
		jmp	loc_0_1186
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_104A:				; CODE XREF: Calc_FlshAuthID_sub_1+3Fj
		mov	ax, di
		sub	ax, 0Eh
		sbb	cx, cx
		and	ax, cx
		add	ax, 0Eh
		mov	[bp+var_6], ax
		mov	cx, di
		sub	cx, ax
		mov	[bp+var_4], cx
		call	GETTICKCOUNT
		push	ax
		call	_srand
		add	sp, 2
		mov	[bp+var_2], 0
		mov	si, [bp+var_2]

loc_0_1076:				; CODE XREF: Calc_FlshAuthID_sub_1+82j
		call	_rand
		mov	cx, 100h
		cwd
		idiv	cx
		mov	[bp+si+var_3C],	dl
		inc	si
		cmp	si, 30h	; '0'
		jl	loc_0_1076
		mov	al, 0Dh
		mov	[bp+var_D], al
		mov	[bp+var_1D], al
		mov	[bp+var_2D], al
		mov	[bp+var_2E], cl
		mov	[bp+var_1E], 1
		mov	[bp+var_E], 2
		lea	di, [bp+var_3C]
		mov	si, 8Ch	; 'Œ'
		mov	ax, ss
		mov	es, ax
		movsw
		movsb
		mov	[bp+var_2], 6
		mov	si, [bp+var_2]

loc_0_10B4:				; CODE XREF: Calc_FlshAuthID_sub_1+C0j
		call	_rand
		mov	cx, 100h
		cwd
		idiv	cx
		mov	[bp+si+var_3C],	dl
		inc	si
		cmp	si, 0Dh
		jl	loc_0_10B4
		mov	ax, [bp+arg_6]
		mov	dx, [bp+arg_8]
		mov	cx, [bp+var_6]
		push	ds
		lea	di, [bp+var_2C]
		mov	si, ax
		push	ss
		pop	es
		mov	ds, dx
		shr	cx, 1
		repe movsw
		adc	cx, cx
		repe movsb
		pop	ds
		cmp	[bp+var_4], 0
		jz	loc_0_1101
		add	ax, 0Eh
		mov	cx, [bp+var_4]
		push	ds
		lea	di, [bp+var_1C]
		mov	si, ax
		mov	ds, dx
		shr	cx, 1
		repe movsw
		adc	cx, cx
		repe movsb
		pop	ds

loc_0_1101:				; CODE XREF: Calc_FlshAuthID_sub_1+E2j
		push	[bp+arg_0]
		push	[bp+arg_4]
		push	[bp+arg_2]
		lea	ax, [bp+var_C]
		push	ss
		push	ax
		lea	ax, [bp+var_3C]
		push	ss
		push	ax
		push	3
		call	AdrProc_DK2SendAlgBuffer
		call	AdrProc_DK2Success
		or	ax, ax
		jnz	loc_0_1128
		mov	al, 66h	; 'f'
		pop	si
		pop	di
		leave
		retf
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_1128:				; CODE XREF: Calc_FlshAuthID_sub_1+11Aj
		cmp	[bp+arg_10], 0
		jz	loc_0_1145
		mov	cx, [bp+arg_10]
		push	ds
		lea	si, [bp+var_1C]
		mov	ax, ss
		mov	ds, ax
		les	di, [bp+arg_C]
		shr	cx, 1
		repe movsw
		adc	cx, cx
		repe movsb
		pop	ds

loc_0_1145:				; CODE XREF: Calc_FlshAuthID_sub_1+126j
		mov	ax, ds
		mov	cx, 3
		push	ds
		mov	di, 90h	; ''
		lea	si, [bp+var_3C]
		mov	es, ax
		assume es:dseg06
		push	ss
		pop	ds
		shr	cx, 1
		sbb	ax, ax
		cmp	cx, cx
		repe cmpsw
		jnz	loc_0_1163
		sub	cx, ax
		repe cmpsb

loc_0_1163:				; CODE XREF: Calc_FlshAuthID_sub_1+157j
		pop	ds
		jnz	loc_0_1180
		cmp	[bp+var_2E], 43h ; 'C'
		jnz	loc_0_1180
		cmp	[bp+var_1E], 4Fh ; 'O'
		jnz	loc_0_1180
		cmp	[bp+var_E], 57h	; 'W'
		jnz	loc_0_1180
		mov	al, [bp+var_10]
		pop	si
		pop	di
		leave
		retf
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
		db  90h	; 
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_1180:				; CODE XREF: Calc_FlshAuthID_sub_1+15Ej
					; Calc_FlshAuthID_sub_1+164j ...
		mov	al, 67h	; 'g'
		pop	si
		pop	di
		leave
		retf
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_1186:				; CODE XREF: Calc_FlshAuthID_sub_1+1Aj
					; Calc_FlshAuthID_sub_1+22j ...
		mov	al, 65h	; 'e'
		pop	si
		pop	di
		leave
		retf
Calc_FlshAuthID_sub_1 endp

; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U B	R O U T	I N E ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ

; Attributes: bp-based frame

Calc_FlshAuthID_sub_2 proc far		; CODE XREF: Calculate_FlshAuthID+B6P
					; sub_0_23C+119P ...

arg_0		= word ptr  6
arg_2		= word ptr  8
arg_4		= byte ptr  0Ah
arg_6		= byte ptr  0Ch

		push	bp
		mov	bp, sp
		push	di
		push	si
		mov	si, [bp+arg_0]
		call	GETTICKCOUNT
		mov	di, ax
		push	ax
		push	cs
		call	near ptr sub_0_1404
		add	sp, 2
		mov	es, [bp+arg_2]
		mov	byte ptr es:[si], 0Dh
		mov	al, [bp+arg_4]
		mov	es:[si+1], al
		mov	ax, di
		mov	al, ah
		mov	es:[si+2], ah
		mov	ax, di
		mov	es:[si+3], al
		mov	di, es
		push	cs
		call	near ptr Calc_FlshAuthID_sub_3
		xor	al, [bp+arg_6]
		mov	es, di
		mov	es:[si+4], al
		pop	si
		pop	di
		leave
		retf
Calc_FlshAuthID_sub_2 endp


; ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ S U B	R O U T	I N E ÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛÛ

; Attributes: bp-based frame

Calc_FlshAuthID_sub_3 proc far		; CODE XREF: Calculate_FlshAuthID+BEP
					; Calculate_FlshAuthID+D0P ...

var_2		= byte ptr -2
var_1		= byte ptr -1

		enter	2, 0
		push	si
		mov	si, 9

loc_0_1418:				; CODE XREF: Calc_FlshAuthID_sub_3+3Fj
		mov	al, byte ptr word_FA8_AC
		mov	[bp+var_1], al
		shr	al, 1
		xor	al, byte ptr word_FA8_AC
		mov	[bp+var_2], al
		test	al, 1
		jz	loc_0_1432
		or	byte ptr word_FA8_AC+1,	80h
		jmp	short loc_0_1437
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_1432:				; CODE XREF: Calc_FlshAuthID_sub_3+19j
		and	byte ptr word_FA8_AC+1,	7Fh

loc_0_1437:				; CODE XREF: Calc_FlshAuthID_sub_3+20j
		shr	word_FA8_AC, 1
		shr	[bp+var_2], 1
		test	[bp+var_1], 1
		jz	loc_0_144A
		or	[bp+var_2], 80h
		jmp	short loc_0_144E
; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

loc_0_144A:				; CODE XREF: Calc_FlshAuthID_sub_3+32j
		and	[bp+var_2], 7Fh

loc_0_144E:				; CODE XREF: Calc_FlshAuthID_sub_3+38j
		dec	si
		jnz	loc_0_1418
		mov	al, [bp+var_2]
		pop	si
		leave
		retf
Calc_FlshAuthID_sub_3 endp

