        LIST P=16C84,E=2
;CONST
RTCC		EQU	01h
INTCON		EQU	0Bh
STATUS		EQU	03h
OPTN		EQU	01h	;(81h)
TRISA		EQU	05h	;(85h)
TRISB		EQU	06h	;(86h)
EECON1		EQU	08h	;(88h)
EECON2		EQU	09h	;(89h)
EEADR		EQU	09h
EEDATA		EQU	08h

PORTA		EQU	05h
PORTB		EQU	06h

;RAM
FLAG	        EQU     0Eh
KEYFL		EQU	0	;BITS
KEYFL1		EQU	1	;
ALERT		EQU	2	;IF ALERT=1 THEN SIGNALIZATION ACTIVAITED
EEPROG		EQU	3	;MODE OF WRITE NEW COD
KEYERR		EQU	4	;IF 1 THEN PRESS ERROR KEY
ALERTF		EQU	5	;WAIT FOR ACTIVAITED ALERT (FIRST WDT)

OUTR	        EQU     0Fh
TMPA	        EQU     10h
TMPW		EQU     11h
TMRH		EQU	12h     ;HIGH BYIT TIMER
TMRL		EQU	13h	;LOW  BYIT TIMER

DATL		EQU	14h
DATH		EQU	15h
CNT		EQU	16h	;QWANTITI OF PRESS KEY
DAT		EQU	17h	;DATA FOR EEPROM
ADDR		EQU	18h	;ADRESS	FOR EEPROM
	

	
        ORG	0h
	GOTO	MAIN
	NOP
	NOP
	NOP
	BTFSS	INTCON,2
	GOTO	MAIN
TMRINT	MOVWF	TMPW
	CLRF	INTCON
	MOVLW	0E0H
	MOVWF	RTCC
	MOVLW	B'10000000'
	OPTION
	MOVFW	TMRL
	ADDLW	1
	MOVWF	TMRL
	BTFSC	STATUS,0
	GOTO	CARY1	
	MOVFW	TMPW
	RETURN

CARY1	BSF	OUTR,0
	INCF	TMRH
	MOVWF	TMPW
	RETURN

MAIN	MOVLW	0h
	TRIS	PORTB
	CLRF	PORTB
	CLRF	PORTA
	CLRF	RTCC
	BSF	STATUS,5
	MOVLW	B'10000000'
	MOVWF	OPTN
	BCF	STATUS,5
	MOVLW	B'10100000'
	MOVWF	INTCON
;	GOTO	ANALIZ
WAIT	BSF	INTCON,5
	BSF	INTCON,7
	BTFSS	PORTA,2
	GOTO	PORT0
PORT1	BTFSC	FLAG,0	
	GOTO	WAIT
	BSF	FLAG,0
	BTFSC	OUTR,0
	GOTO	GETZER
	INCF	CNT
	MOVFW	TMRL
	ADDLW	0E7h
	BTFSS	STATUS,0
	GOTO	WAIT_1
	CLRF	TMRL
	
	MOVFW	CNT
	MOVWF	TMPA

	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATL,0
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATL,1
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATL,2
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATL,3
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATL,4
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATL,5
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATL,6
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATL,7
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATH,0
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATH,1
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATH,2
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATH,3
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATH,4
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATH,5
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATH,6
	DECF	TMPA
	BTFSC	STATUS,2	;(ZERO)
	BSF	DATH,7
	
	MOVFW	CNT
	XORLW	10h
	BTFSS	STATUS,2
	GOTO	WAIT	
	GOTO	ANALIZ
		
PORT0	BTFSS	FLAG,0
	GOTO	WAIT
	CLRF	FLAG
	BTFSC	OUTR,0
	GOTO	GETZER
	CLRF	TMRL
	GOTO	WAIT


GETZER	CLRF	CNT
	CLRF	TMRL
	CLRF	OUTR
	CLRF	DATL
	CLRF	DATH
	GOTO	WAIT

WAIT_1	CLRF	TMRL
	MOVFW	CNT
	XORLW	10h
	BTFSS	STATUS,2
	GOTO	WAIT	
	GOTO	ANALIZ

ANALIZ
	CLRF	INTCON	
	MOVFW	DATL
	MOVWF	EEDATA
	CLRF	EEADR
	
EEWRIT0	BSF	STATUS,5
        BSF	EECON1,2
        MOVLW	055h
	MOVWF	EECON2
	MOVLW	0AAh
	MOVWF	EECON2
	BSF	EECON1,1
_EEWRI	BTFSS	EECON1,4
	GOTO	_EEWRI

	BCF	EECON1,2
	BCF	EECON1,4
	BCF	STATUS,5
	MOVFW	DATH
	MOVWF	EEDATA
	CLRF	EEADR
	INCF	EEADR
EEWRIT1	BSF	STATUS,5
        BSF	EECON1,2
        MOVLW	055h
	MOVWF	EECON2
	MOVLW	0AAh
	MOVWF	EECON2
	BSF	EECON1,1
EEWRI	BTFSS	EECON1,4
	GOTO	EEWRI

	BCF	EECON1,2
	BCF	EECON1,4
	BCF	STATUS,5
;PR1	RETURN
	MOVLW	B'10100000'
	MOVWF	INTCON
;WAIT1
	GOTO	WAIT
END
