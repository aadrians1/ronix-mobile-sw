Глоссарий терминов:
~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
   [TBC]:  подтвержден
   [TBD]:  определен
   S.N.: Серийный номер

   B (i): бит i
   B (i .. j): биты от i до j (если i> j затем область читается в обратном порядке)
   B (I): байт I
   B (I.. J): байты от я до J (если I> J затем область читается в обратном порядке)
   X^y: x в (зависимости от)  at the power  y (в математическом выражении)

   Серийный номер: Уникальный номер, назначенный к чипу, этот номер программируемый
                   чипе изготовителем, Вы не можете его изменить это. Некоторые     
                   карты не имеют серийный номер. Копия серийного номера  иногда 
                   печатается непосредственно на карте .

   Контрольная сумма: Контрольные суммы используются, чтобы проверить изменен ли 
                      заголовок карты.Например один байт заголовка вычислен, используя
                      a -простую формулу (то есть: для а бит установен в " 1 "
                      в байтах 1, 2, 3  Substract 4 к значению 227, Вы должны 
                      получить набор значений в байте 0 платы). Вы можете использовать
                      эти контрольные суммы (и другие биты в области заголовка) чтобы 
                      проверить, имеет ли карта a данный тип. Этот документ  вам это
                      сделать.

   Сертификат: сертификат(потверждерие)  используются в 2-ом поколении телекарт, 
                      чтобы проверить подинность паты. Сертификат обычно динной
                      16 или 32 бита и вычисяется используя функцию (свою у 
                      каждого оператора) , секретный ключ (также зависимый от
                      оператора ) и  значение битов, содержащихся в заголовке карты.
                      Так как функция и ключ - сохраняются в секрете, Вы не можете
                      вычислить , и использовать это:  проверьте, имеет ли картата
                      данный тип.
                      Хaкеры, делающие crypto-анализ против сертификата, используют 
                      большое число плат, это может быть уничтожено, когда карта пуста.
                      Запись в этой области может лишать законной силы карту.

   Обасть   
   Счетчик /Единиц : Эта область содержит номер оставшихся (или использованых) 
                     единиц может быть разработан, так что вы не сможете увеличить
                     значение единиц на карте. Как эта область работает 
                     (декодирование, и запись) зависит от типа карты. Этот документ
                     поможет вам  вычислить  остающийся кредит катры.


   Анти-бешенства флаг:  (также известный как флаг полного выхода) используются 
                     для, того чтобы гарантировать, что держатель карты не запатит
                     деньги, если он удалит плату в течение операции.
                     Анти-бешеные флажки написаны, когда область счетчика не записана,
                     они уничтожены, когда операция завершена.
                     Если плата удалена в течение операции они   используются, чтобы
                     восстановить область счетчика в следующий раз при использовании 
                     карты.


*Содержание* ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

I) 1-ое поколение тeлекарт:

1.1 - Введение:
1.2 - Схема чипа:
1.3 - PINOUT конектора:
1.4 - Основные особенности:
1.5 - Временные диаграммы
1.6 - Карта памяти для карт из ФРАНЦИИ и МОНАКО:
1.7 - Карта памяти для карт из других стран:
1.8 - Карта памяти для карт из ИСПАНИИ, CROATIA и МЕКСИКИ:
1.9 - Карта памяти для Мексиканских карт из Telmex:


II) 2-ые поколения телекарт:

2.1 - Введение:
2.2 - Pinout:
2.3 - Основные особенности:
2.4 - Временные диаграммы:
2.5 - Карта памяти:

2.5.1 - Карта памяти для 4 или 5 ступенчатых восьмеричный счетчик единиц:
2.5.2 - Карта памяти для новой 512 битной Греческой телекарты:
2.5.3 - 2-ой поколение Французских телекарт (TG2):

2.6 - Электрические особенности:


III) Схемные решения считатывателей:

3.1 - 1 считатывателей (очень простой, только для телекарт)
3.2 - Считатыватель 2 (для телекарт и ISO7816 карт также)


--------------------------------------- ---------------------------------------

I) 1-ое поколение телекарт:
============================

1.1 - Введение:
~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

В середину 80'х появилась новое поколение карт (интеллектуальные карты или чип карты) которые заменили 
большинство магнитных  особенно в абонировании теекомуникаций и также для кредитных карточек. Эти карты
гораздо более безопасны чем магнитные карты, и имеется несколько видов карт . Simplier - Простые 
Карточки с памятью подобные тем что используются, в телефонной связи, поскольку телекарты используются
общих телефонах ( все содержание памяти читаемо, и имеется область изготовителя, которая является 
неперезаписываемой), затем имеется большое количество sofisticated(програмируемых) карт:  с областью 
памяти защищенной ключом, эти карты могут содержать некоторую частную информацию в защищенной от чтения
области.Тфкже имеются  микропроцессор-карты (работающих по протоколу -7816), которые являются гибкими, 
так как эти карты имеют их собственную внутреннюю Операционную систему, которые предотвращают ввод-вывод,
если PIN (Персональный Идентификационный Номер) не был введен (Эти карты используются, когда 
конфиденциальность необходима, подобно в кредитных карточках  (банке, crypted  картах доступа ТЕЛЕВИДЕНИЯ,
картах здоровья, SIM в картах для GSM, и т.д ...).

Относительно телекарт, даже если эти карты - менее безопасные, не думаю, что Вы сможете звонить свободно.
Все данные читаемы до тех пор пока не имеется никаких конфиденциальных данных внутри, карты хорошо 
выполнены( достаточно, чтобы быть очень безопасными для  связи  в общей теефонной кабине).              

Так, что является phonecard точно? Фактически обычно это - 256 битов EPROM ( подобно французски картам),
или 128 битов EEPROM ( подобно немецким картам) с последовательным выводом и некоторыми другими пинами 
управления.

Почему  нельзя повторно заполнить? Хорошо, действительно, чтобы повторно заполнить карту Вы  должны стереть
карты с UV, зная, что карты покрыты в UV непрозрачной смолой, которые предотвращают UV от достижения кремния
чипа, и даже если бы Вы смогли бы,  стереть чип, Вы будете должны программировать  область, которая защищена
от записи плавким предохранителем блокировки, который был соединен после программирования карты на фабрике.

Не забудьте, что общий телефон содержит специализированный компьютер и иметь прямую связь к общей телефонной
сети, и так на другие компьютеры. Во Франции общие телефоны соединены с телефонной сетью, использующей
" Unite  de raccordement de publiphone (URP)" который содержит " черный список " захваченных, карт фальшивок
... таксофон сначала читает карту, проверяет,(контрольные суммы, сертификаты ...) если  OK, то просит, чтобы
URP проверил, сообщена ли карта захваченной или известна как фальшивка, и затем  позволяет Вам набирать номер.

НЕ ЗАБУДЬТЕ: если Вы пробуете использовать карту фальшивку, таксофон может позволить Вам звонить, и URP подаст
тревогу оператору, кто может вызывать полицию. Много людей во Франции  заключено в тюрьму по этому пути.
ТАК ЧТО НА ВОПРОСЫ ОТНОСИТЕЛЬНО ИМИТАЦИИ, ПЕРЕЗАРЯЖАЮЩЕЙ ... PHONECARDS НЕБУДУ ОТВЕЧАТЬ, ПОСКОЛЬКУ ЭТО 
ЗАПРЕЩЕННО И МОЖЕТ БЫТЬ ОЧЕНЬ ПЛОХО ДЛЯ  ВАШЕЙ КАРМЫ.

 
Французские  телекарт были созданы, в 1984 и в те времена конструктор решил формировать эти карты в NMOS 
технологии, но теперь, Франция, телесвязь заменила все таксофоны и использует CMOS технологию для 70 % карт 
в настоящее время (07/1997).

Также они планируют использовать EEPROM, чтобы защитить карты и добавить много применимой информации,
и Вы возможно используете карты телефона, чтобы покупать хлеб или что - нибудь еще. Картыты, используемые для 
рекламы могут программироваться, так таксофон автоматически вызывает данный номер, когда карта вставлена.
рекламодатель может выбирать, кто может вызывать свободно и где пользователь не должен беспокоить).

These cards are called Second Generation Telecards (T2G).


   1.2 - SCHEMATICS of the chip:
         ~~~~~~~~~~~~~~~~~~~~~~

        .-----------------.
      --|>_ Clk           |
      --| R/W             |
      --| Reset           |
      --| Fuse            |
      --| Vpp             |
        '-,             ,-'
        .-'-------------'-.
        |             Out |-- serial output
        '-----------------'


   1.3 - PINOUT of the connector:
         ~~~~~~~~~~~~~~~~~~~~~~~


                               AFNOR CHIP
                               ----------
        Afnor Position                              ISO position
   (in the left top corner)                     (in the middle left)

,-------------+-------------,               ,-------------+-------------,
|   8         |         4   |               |   1         |         5   |
+-------\     |     /-------+               +-------\     |     /-------+
|   7    +----+----+    3   |               |   2    +----+    +    6   |
+--------|         |--------+               +--------|         |--------+
|   6    +    +----+    2   |               |   3    +----+----+    7   |
+-------/     |     \-------+               +-------/     |     \-------+
|   5         |         1   |               |   4         |         8   |
'-------------+-------------'               '-------------+-------------'

NB: only the position of the chip is ISO standardized and not the pinout.

PINOUT:   1 : Vcc = 5V     5 : Gnd
~~~~~~    2 : R/W          6 : Vpp = 21V   (*)
          3 : Clock        7 : I/O
          4 : RAS          8 : Fus         (*)

( *) Не используемый с новым G + D картами, совместимые с 256 разрядной памятью например: spannish G + D платы.


1.4 - Основные особенности:
~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

- Синхронный протокол.
- N-MOS технология или CMOS для новых. - 256x1 разрядная организация.
- 96 написався защищенный плавким предохранителем Блокировки. - Малая мощность 85mW в режиме чтения.
- 21 V напряжение программирования.
- Время доступа: 500ns
- Температурный диапазон: -10C +70C
- 4-летние сохранение данных .


1.5 - временные диаграммы:
~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
a - Платы из Schlumberger, Solaic, Gemplus ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~


+21V                                     _____________
+5V ____________________________________|             |_________________ VPP
                                        :             :
+5V                  ___________________:_____________:_________________ ___
0V  ________________|                   :             :                  RST
                    :                   :             :
+5V     ____        :      ____         :       ______:______
0V  ___|    |_______:_____|    |________:______|      :      |__________ CLK
       :    :       :     :    :        :      :      :      :
+5V    :    :       :     :    :        :______:______:      :           _
0V  ___:____:_______:_____:____:________|      :      |______:__________ R/W
       :    :       :     :    :        :      :      :      :
+5V    :    :       :_____:    :________:      :      :      :__________
0V  XXXXXXXXXXXXXXXXX_____XXXXXX________XXXXXXXXXXXXXXXXXXXXXX__________ OUT
       :    :       :     :    :        :<-----><---->:      :
       :    :       :     :    :        :10 to   10 to       :
       :    :       :     :    :        :50 ms   50ms        :
        Reset        Bit0         Bit1                           Bit2
        card        reading      reading  Bit1 writing to 1     reading


ОБРАТИТЕ ВНИМАНИЕ: Vpp Неактивное состояние - 5V, таким образом Vpp будет должен быть соединен с Vcc,
чтобы считать карту.

b - Картыты из G + D (Испанские платы, помеченные 5-ым байтом = $30) ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

+5V                  ___________________________________________________ ___
0V  ________________|                                                    RST

+5V     ____               ____                 _____________
0V  ___|    |_____________|    |_______________|             |__________ CLK
       :    :             :    :               :             :
+5V    :    :             :    :         ______:______       :           _
0V  ___:____:_____________:____:________|      :      |______:__________ R/W
       :    :             :    :               :      :      :
+5V    :____:_____________:____:_______________:______:______:__________
0V  XXXX    X_____________X    X_______________X      :      X__________ OUT
       :    :             :    :               :<---->:      :
       :    :             :    :               : 1 ms        :
       :    :             :    :               :             :
        Reset     Bit0               Bit1           Bit1          Bit2
        card     reading            reading      writing to 1    reading

1.6 - Memory Map for cards from FRANCE, MONACO and St MAARTEN:
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Byte (Bit)      Hexa

              +-----+
0 (0..7)      |     | --> Checksum for bytes 1, 2, 3 (*)
              +-----+
1 (8..15)     | $0s | --> French telecard
              |     |     Serial Number (1st byte)
              | $80 | --> St Maarten
              +-----+
2 (16..23)    |     | --> Serial Number (2nd byte)
              +-----+
3 (24..31)    |     | --> Serial Number (3rd byte)
              +-----+
4 (32..39)    |     | --> checksum for bytes 5, 6, 7 (*)
              +-----+
5 (40..47)    |     | --> Serial Number (4th byte)
              +-----+
6 (48..55)    |     | --> Serial Number (5th byte)
              +-----+
7 (56..63)    |     | --> ? [TBD]
              | $FF | --> St Maarten
              +-----+
8 (64..71)    |     | --> checksum for byte 9, 10, 11 (*)
              +-----+
9  (72..79)   |     | --> ? [TBD]
              | $FF | --> St Maarten
              +-----+
10 (80..87)   | $10 | --> France and Monaco
              | $14 | --> St Maarten
              +-----+
11 (88..95)   | $13 | --> 120 units
              | $07 | --> 60 units (St Maarten)
              | $06 | --> 50 units
              | $05 | --> 40 units
              | $04 | --> 25 units
              | $02 | --> 5 units
              +-----+
12 (96..103)  |     | --> The units area: each time a unit is used
     .        |     |     then a bit is set to "1"; The 1st 10 units
     .        |     |     are fused in factory for test (15 units for
     .        |     |     25u and 5u cards).
     .        |     |
     .        |     |
30 (240..247) |     |
              +-----+
31 (248..255) | $FF | --> $FF is set when all the units are used.
              +-----+

(*) checksum is calculated by the following expresion:

              max                | min=32*(j-1)+8
    $E3 - 4 * Sum b(i)     where | max=32*j-1
             i=min               | and j is the checksum number (1, 2 or 3)

NOTE: The card number is the concatenation in a single string of the 5 bytes
      written in hexadecimal.



   1.7 - Memory Map for cards from other countries:
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


Byte (Bit)      Hexa

               +-----+                              95
0 (0..7)       |     |  --> Check Sum Byte = $D8 - Sum b(i)
               +-----+                             i=8
1 (8..15)      | $83 |  --> Telecard
               | $80 |  --> Other Applications (See below)
               | $9A |  --> PIAF card [TBC]
               | $C0 |  --> AVANT card [TBC]
               +-----+-----+
2-3 (16..31)   | $1x | $xx |  --> Units+2 (0x1152 : exemple for a 150u card).
               + - - - - - +
               | $10 | $00 |  --> In case of special Argentine telecard
               | $3D | $13 |  -->  80u (Morocco)
               | $DB | $B5 |  -->  40u (Morocco)
               +-----+-----+

               ARGENTINA
               +-----+-----+-----+-----+
4..7 (32..63)  | $Ta | $bc | $de | $fg | T = Manufacturer (4 Gemplus, 0 Schlumberger)
               |     |     |     |     | S.N. = a*64 + b*32 + c*16 + d*8 + e*4 + f*2 + g
               +-----+-----+-----+-----+
8..9  (64..79) |     |     | --> Don't Know
               +-----+-----+

               HUNGARY
               +-----+-----+-----+-----+
4..7 (32..63)  | $Ta | $B  | $C  | $D  | T = Manufacturer (4 Gemplus, C ODS)
               |     |     |     |     | S.N. = a*2^21 + B*2^17 + C*2^9 + D
               +-----+-----+-----+-----+
8..9  (64..79) |     |     | --> Unit value : $0103 for 120u;  $010A for 50u
               +-----+-----+

               PORTUGAL
               +-----+-----+-----+-----+
4..7 (32..63)  | $00 | $A  | $B  | $C  | Portugal : S.N. = A*2^17 + B*2^9 + C
               +-----+-----+-----+-----+
8..9  (64..79) |     |     | --> Certificate
               +-----+-----+

               OTHERS
               +-----+
4 (32..39)     | $Tx | --> T = Manufacturer 0 --> Schlumberger
               |     | -->                  1 --> Solaic [TBC]
               |     | -->                  3 --> Gemplus [TBC] (finnish cards)
               |     | -->                  4 --> Gemplus
               +-----+----+----+----+----+
5..9  (40..79) |     |    |    |    |    | --> Serial Number
               +-----+----+----+----+----+

               +-----+-----+
10-11(80..95)  | $10 | $16 | --> French Polynesia
               |     | $78 | --> DisneyLand Paris (see note)
               | $11 | $15 | --> Djibouti
               |     | $1C | --> Senegal (Sonatel)
               |     | $1D | --> French Cinecarte [TBC]
               |     | $1E | --> Sweden
               |     | $30 | --> Norway
               |     | $31 | --> New Caledonia
               |     | $32 | --> Cameroon
               |     | $33 | --> Andorra
               |     | $36 | --> Central African Republic (Socatel)
               |     | $39 | --> Luxembourg
               |     | $3C | --> Ireland
               |     | $3D | --> Gambia
               |     | $47 | --> Portugal
               |     | $54 | --> Malta
               |     | $55 | --> Czech Republic / Yougoslavia [TBC]
               |     | $58 | --> Comores
               |     | $5C | --> Argentina
               |     | $5D | --> Burkina Faso
               |     | $5E | --> Mali
               |     | $5F | --> Gabon
               |     | $65 | --> Finland
               |     | $72 | --> Togo (OPT Togo)
               |     | $86 | --> Slovakia
               |     | $9E | --> Cuba (Etecsa)
               |     | $B7 | --> Morocco (Special Operator)
               |     | $C3 | --> Emirates (Etisalat)
               |     | $E0 | --> Hungary
               |     | $E1 | --> Cameroon (CamTel)
               |     | $E2 | --> Morocco (Ave Phone)
               | $1E | $5C | --> Argentina (Special Cards)
               +-----+-----+
12 (96..103)   |     | --> The units area: each time a unit
     .         |     |     is used, then a bit is set to "1";
     .         |     |
     .         |     |     The first two units are fused in
     .         |     |     factory as test.
     .         |     |
     .         |     |     In some countries 5 extra units are burned when the
     .         |     |     card is empty (credit seems to be -5 units).
     .         |     |
     .         |     |     Hungary: Each bit set to 1 in this area is a unit used.
     .         |     |     ~~~~~~~  10u are used in factory when the cards is new.
31 (248..255)  |     |
               +-----+

Note for DisneyLand Paris: Unit Area is b(128..239), B(30) is set to $FF to
                           mark an empty card.

               ARGENTINA SPECIAL
               +-----+
12 (96..103)   | $C0 |  --> The first two units are fused in factory as test.
      .        |     |
      .        |     |
20-21(160..175)|$XXXX|  --> User number Eg. $2456
22-23(176..191)|$XXXX|                      $1252  --> 2456 1252 6578
24-25(192..207)|$XXXX|                      $6578
      .        |     |
      .        |     |
30 (240..247)  |     |
               +-----+


   1.8 - Memory Map for cards from Argentina, Spain, Croatia and Mexico:
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   The spanish telecards are made from different manufacturers, and these cards
   should be read and written with a different protocol following byte 04
   of the memory (see subclause 1.6-a for the cards with the byte 04=$90 and
   see the subclause 1.6-b for the cards with the byte 04=$30).


Byte (Bit)       Binary    Hexa

              +-----------+-----+                            95
0 (0..7)      |           |     | ---> Checksum byte = 216 - Sum b(i)
              +-----------+-----+                            i=8
1 (8..15)     | 1000 0011 | $83 | ---> Telecard
              +-----------+-----+
2 (16..23)    | 1111 1111 | $FF |
              +-----------+-----+
3 (24..31)    | 1111 1111 | $FF |
              +-----------+-----+
4 (32..39)    | 1001 0000 | $90 | --> Oberthur
              | 1001 1110 | $9E | --> Oberthur (Argentina)
              | 0011 0000 | $30 | --> G+D
              | 0101 1010 | $5A | --> Gemplus
              | 0101 0000 | $A0 | --> Solaic
              +-----------+-----+
5 (40..47)    |           |     |
6 (48..55)    |           |     | ---> Serial Number (*)
7 (56..63)    |           |     |
              +-----------+-----+-----------+-----+
8-9  (64..79) | 0000 0000 | $00 | 0000 1010 | $0A | -->  500 pesetas (spain)
              | 0001 0100 | $14 | 1000 1010 | $8A | --> 1000 pesetas (spain)
              | 0010 0101 | $25 | 0000 0100 | $04 | --> 2000 pesetas (spain)
              | 0010 0101 | $25 | 0000 0110 | $06 | --> 2100 pesetas (spain)
              | 0001 0100 | $14 | 1100 1010 | $CA | --> N$ 25.00 (Mexico)
              | 0000 0000 | $00 | 0000 0011 | $03 | --> 25 (Argentina)
              | 0000 0000 | $00 | 0000 1010 | $0A | --> 100u (Croatia)
              | 0010 1010 | $2A | 0010 0101 | $85 | --> 1000u (Croatia)
              +-----------+-----+-----------+-----+
10 (80..87)   | 0001 1110 | $1E |
              +-----------+-----+
11 (88..95)   | 0010 0010 | $22 | --> Spain
              | 0010 0100 | $24 | --> Mexico
              | 0010 0110 | $26 | --> Croatia
              | 0010 1000 | $28 | --> Argentina
              +-----------+-----+
12 (96..103)  | 1111 1111 | $FF | ---> the first 10 units are fused
    .         | 11xx xxxx | $xx |      in factory for testing.
    .         | xxxx xxxx | $xx |
    .         | xxxx xxxx | $xx | ---> Slow counter area
    .         | xxxx xxxx | $xx |
    .         +-----------+-----+
    .         | xxxx xxxx | $xx |
    .         | xxxx xxxx | $xx | ---> Fast counter area
31 (248..255) | xxxx xxxx | $xx |
              +-----------+-----+

   The slow counter area:
   ----------------------
       - Increment: counts units by an increment of 5 pesetas
       - size:
                o [b156 ... b255] for  500 pesetas cards
                o [b106 ... b205] for 1000 pesetas cards
                o [b126 ... b165] for 2000 pesetas cards
                o [b106 ... b165] for 2100 pesetas cards

   The Fast counter area:
   ----------------------
       - Increment: counts units by an increment of
                o No fast counter area for the 500 pesetas cards.
                o 10 pesetas for the 1000 pesetas cards
                o 20 pesetas for the 2000 pesetas cards
                o 20 pesetas for the 2100 pesetas cards

       - size:
                o No fast counter area for the 500 pesetas cards.
                o [b206 ... b255] for the 1000 pesetas cards
                o [b166 ... b255] for the 2000 pesetas cards
                o [b166 ... b255] for the 2100 pesetas cards

   Exemple of an fast units area: (1000 pesetas cards)
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                00 -,
         0000 0000  |
         0000 0000  |-> Unused units
         0000 0000  |
         0000 0000 -'
         0011 1110 ---> 14*10 pesetas are used (same as 0011 1111
         1000 1110                                      1111 1111)

   NB: Several units can be used, in this case only the last unit is set as
       used, like in the previous exemple, where some units are set to 0 but
       are nonetheless used.

   (*) Serial Number for spanish telecards: The serial number for G+D,
       Gemplus and Solaic telecards is directly obtained by the following formula:

                 Byte[5]*$10000 + Byte[6]*$100 + Byte[7]

   1.9a - Memory Map for Mexican cards from Telmex (LadaTel):
          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Byte (Bit)     Hexa

              +-----+                              95
0 (0..7)      |     | ---> Check Sum Byte = 216 - Sum b(i)
              +-----+                             i=8
1 (8..15)     | $80 |
              +-----+
2 (16..23)    |     |
3 (24..31)    |     | --> [TBD]
              +-----+
4 (32..39)    | $0s | --> Schlumberger
              | $1s | --> Solaic [TBC]
              | $4s | --> Gemplus
              +-----+
5 (40..47)    |  ss |
6 (48..55)    |  ss | --> Serial Number (*)
7 (56..63)    |  ss |
              +-----+-----+
8-9  (64..79) | $sv |  vC | --> Card Value (*)
              +-----+-----+
10 (80..87)   | $32 |
              | $64 | --> [TBD]
              +-----+
11 (88..95)   | $59 | --> Mexico
              +-----+
12 (96..103)  |     | ---> The units area: each time a unit
     .        |     |      is used, then a bit is set to "1";
     .        |     |
     .        |     |      The first 4 units are fused in
     .        |     |      factory as test.
     .        |     |
30 (240..247) |     |
              +-----+
31 (248..255) | $FF | --> $FF is set when all the units are used.
              +-----+


Serial Number = b(34..65) displayed in decimal

Card Value: Each unit has 0.5N$ worth. Units burned in factory are not counted
            in the value (so a 40 units card has a 20N$ value and 44 units are
            burned when card is empty).

   1.9b - Memory Map for Ivory Coast cards from publicom S.A.:
          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Byte (Bit)     Hexa

              +-----+                              95
0 (0..7)      |     | ---> Check Sum Byte = 216 - Sum b(i)
              +-----+                             i=8
1 (8..15)     | $80 |
              +-----+
2 (16..23)    |     |
3 (24..31)    |     | --> [TBD]
              +-----+
4 (32..39)    | $0s | --> Schlumberger
              | $1s | --> Solaic [TBC]
              | $4s | --> Gemplus
              +-----+
5 (40..47)    |  ss |
6 (48..55)    |  ss | --> Serial Number (*)
7 (56..63)    |  ss |
              +-----+-----+
8-9  (64..79) | $sv |  vC | --> Card Value (*)
              +-----+-----+
10 (80..87)   | $32 |
              | $64 | --> [TBD]
              +-----+
11 (88..95)   | $59 | --> Mexico
              +-----+
12 (96..103)  |     | ---> The units area: each time a unit
     .        |     |      is used, then a bit is set to "1";
     .        |     |
     .        |     |      The first 4 units are fused in
     .        |     |      factory as test.
     .        |     |
30 (240..247) |     |
              +-----+
31 (248..255) | $FF | --> $FF is set when all the units are used.
              +-----+

Serial Number = b(34..65) displayed in decimal

Card Value: Units burned in factory are not counted in the value (so
            a 40 units card has a 20N$ value and 44 units are burned
            when card is empty).


1.10 - Memory Map for Slovenian Cards:
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Byte (Bit)     Hexa

              +-----+
0 (0..7)      | $5A |
              +-----+
1 (8..15)     | $vv | --> Unit Value
              |     |     $81 -> 100u
              |     |     $82 -> 20u
              |     |     $83 -> 300u (2 units/bit)
              |     |     $84 -> 100u (not used)
              |     |     $85 -> 50u
              |     |     $86 -> 25u
              +-----+-----+-----+
2..4 (16..39) | $E9 | $B5 | $4B | --> Telekom cards
              |     | $B4 |     | --> "Impulz" cards
              +-----+-----+-----+
5 (40..47)    | $00 |
              | $01 | --> first digit of serial number
              +-----+
6 (48..55)    | $xx | --> Serial Number = (B(6) << 16) + (B(7)  << 8) + B(8)
7 (56..63)    | $xx |
8 (64..71)    | $xx |
              +-----+
9  (72..79)   | $yy | --> Signature for the S.N.
10 (80..87)   | $yy |
              +-----+                                             10
11 (88..95)   | $zz | --> Checksum for B[0] .. B[10] = 0xFF & [( Sum B(i) )-1]
              |     |                                            i=0
              +-----+
12 (96..103)  |     | --> The units area: each time a unit
     .        |     |     is used, then a bit is set to "1";
     .        |     |
     .        |     |
     .        |     |
31 (248..255) |     |
              +-----+

II) 2-ое поколение телекарт:
     ============================

   2.1 - Введение:
         ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

   Эти карты - фактически 128 bit памяти в NMOS технологии,  картa
   содержит следующее:

        64 бит EPROM прописанный, защищенный ( область изготовителя).
        40 бита EEPROM (5x8 биты).
        Набор 24 бита установлены в "1".

2.2 - Pinout:
         ~~~~~~

           ISO 7816-2

 ,-------------+-------------,
 |   1         |         5   |   Pinout:
 +-------\     |     /-------+   ~~~~~~
 |   2    +----+    +    6   |     1 : VCC=5V    5 : Gnd
 +--------|         |--------+     2 : Reset     6 : n.c.
 |   3    +----+----+    7   |     3 : Clock     7 : I/O
 +-------/     |     \-------+     4 : n.c.      8 : n.c.
 |   4         |         8   |
 '-------------+-------------'     (n.c. : not connected)


2.3 - Основные особенности:
         ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

        - ISO 7816- совместимый 1/2.
        - Использует только 5V питание.
        - Малая мощность .
        - NMOS технология.

   2.4 - Временная диаграмма:
         ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~

Сброс(Reset):
------
  Счетчик адресов сброшен в 0, когда  линия clock  CLK,  поднята в то время как
на линия управления R высокий уровень {, обращают внимание, что счетчик адресов может
не сбросится  в диапазоне 0 к 7}.
      __________________
_____|                  |_____________________________________________ Reset
     :                  :
     :        _____     :  _____       _____       _____       _____
_____:_______|     |____:_|     |_____|     |_____|     |_____|     |_ Clk
     :       :          : :     :     :     :     :     :     :     :
_____:_______:__________:_:_____:_____:_____:_____:_____:_____:_____:_
_____:___n___|_____0____:_|_____1_____|_____2_____|_____3_____|___4_:_(Address)
     :                  :       :           :           :           :
_____:                  :_______:___________:___________:___________:_
_____XXXXXXXXXXXXXXXXXXXX_______|___________|___________|___________|_ Data
Bit n                      Bit 0    Bit 1        Bit2       Bit3

Счетчик адресов увеличивается по фронту тактового импуьса на 1 пока Reset, остается низким. Каждый адресованный бит выводится к контакту ввода - вывода каждый раз Clk падaет.Счетчик может быть только увеличен. Если Вы хотите считать бит с адресом меньше текущего, то счетчик нужно сбросить в 0, а затем увеличить до необходимого значения .


Запись:
------
   Все незаписанные или стёртые биты в адресе 64-104 могут быть незаписаны.
Когда ячейка памяти незаписана, то есть установлена в 0. Адресованная ячейка
Незаписаная следующей последовательностью.

1- Reset поднят, в то время как Clk низок что отключает приращение счетчика адреса для каждого тактового импульса .

2- Clk затем поднят для минимума 10ms, чтобы писать бит адреса.

Когда  операция кончиась, и  Clk упал счетчик адресов разблокирован
 содержание зфписанной ячейки,  является теперь 0, выводится на
 контакт ввода - вывода , если операция правильна.

Следующий Clk импульс увеличит адрес на единицу, затем пишущаеся
последовательность может быть повторена, чтобы писать следующий бит.

	      _____                                _____
____________|     |______________________________|     |_______________ Reset
            :                                    :
    ___     :           _____           ___      :           _____
___|   |____:__________|     |_________|   |_____:__________|     |____ Clk
   :        :          :     :         :   :     :          :     :
___:________:__________:_____:_________:___:_____:__________:_____:_____
n  |      n+1          |     n+2       |   :    n+3         |     :      (Addr)
---'--------:----------'-----:---------'---:-----:----------'-----:-----
            :          :     :             :     :          :     :
________   _:          :     : ____________:  ___:          :     :
________XXX_XXXXXXXXXXXXXXXXXXX____________ XX___XXXXXXXXXXXXXXXXXXXXXXX I/O
  n      n+1           :     :     n+1        n+2           :     :
                       :     :                              :     :
                        write                                write



WriteCarry:(запись с переносом)
-----------

   Счетчик уничтожается,  выполняя WRITECARRY последовательность на
 следующего самого высокого разряда , чтобы быть уничтоженным.

Writecarry последовательность следующая:

1 - Установить счетчик адресов к незаписанному биту в следующем самом высоком
разряде счетчика котрый должен быть уничтожен.

2 - Приращение заблокировано на следующем фронте импуьса R где Clk
остается низким.

3 - Clk затем поднят до минимума 10ms, в то время как R низок, запись
в следующий биту адреса.

4 - R поднят снова, в то время как Clk остается низким, чтобы отключить приращение второй раз.

5 - Clk поднят до минимума 1ms, в то время как R низок, запись 
в адресованный бит второй  раз, стирая уровень счетчика непосредственно
ниже этого адресованного бита.



       _____                      _____
______|     |____________________|     |_________________________________  Rst
      :                          :
      :            _______       :              _______        ___
______:___________|       |______:_____________|       |______|   |______  Clk
      :           :       :      :             :       :      :   :
      :           :       :      :             :       :      :   :
<------------------------- address n ------------------------>:<--- n+1 ------
      :           :       :      :             :       :          :
      :           :       :      :             :       :          :
______:           :       :______:             :       :__________: _____
______XXXXXXXXXXXXXXXXXXXXX______XXXXXXXXXXXXXXXXXXXXXXX__________XX_____  I/O
		  :       :  n                 :       :     n        n+1
		  :       :                    :       :
		    Write                        Erase

     II-5) Memory Map:
	 -------------

Bytes       Bits      Binary     Hexa

		    +-----------+-----+
  1       1 -->   8 |           |     |
		    +-----------+-----+
  2       9 -->  16 | 0010 1111 | $2F | ---> Germany
		    | 0011 0111 | $37 | ---> Netherland
		    | 0011 1011 | $3B | ---> Greece
		    +-----------+-----+
  3      17 -->  24 |           |     |
  4      25 -->  32 |           |     | ---> Issuer area (written protected)
  5      33 -->  40 |           |     |
  6      41 -->  48 |           |     |
  7      49 -->  56 |           |     |
  8      57 -->  64 |           |     |
		    +-----------+-----+
  9      65 -->  72 |           |     | ---> c4096  )
 10      73 -->  80 |           |     | --->  c512  )
 11      81 -->  88 |           |     | --->   c64  ) 5 stage octal counter
 12      89 -->  96 |           |     | --->    c8  )
 13      97 --> 104 |           |     | --->    c0  )
		    +-----------+-----+
 14     105 --> 112 | 1111 1111 | $FF |
 15     113 --> 120 | 1111 1111 | $FF | ---> area of bits set to "1"
 16     120 --> 128 | 1111 1111 | $FF |
		    +-----------+-----+

The Issuer area:
----------------

    This issuer consists of 40 bits. The contents of the issuer area are
specified by the card issuer, and are fixed during the manufacturing
process. The contents of the issuer area will include data such as
serial numbers, dates, and distribution centers.

This area may only be read.

The Counter area:
-----------------

   The counter area stores the card's units. Its initial value is
specified by the card issuer and set during manufacturing.

The counter area is divided into a 5 stage abacus.

Note that you can only decrease the counter and it is not authorized to
write in the counter a value greater than the old value.


    I-6) Electrical features:
	--------------------

Maximum ratings:
----------------

		       +--------+------+------+------+
		       | Symbol | Min  |  Max | Unit |
+----------------------+--------+------+------+------+
| Supply voltage       |   Vcc  | -0.3 |    6 |   V  |
+----------------------+--------+------+------+------+
| Input voltage        |   Vss  | -0.3 |    6 |   V  |
+----------------------+--------+------+------+------+
| Storage temperature  |  Tstg  |  -20 |  +55 |  0C  |
+----------------------+--------+------+------+------+
| Power dissipation   |    Pd  |   -  |   50 |  mW  |
+----------------------+--------+------+------+------+


DC characteristics:
------------------
			    +--------+-----+-----+-----+------+
			    | Symbol | Min.| Typ.| Max.| Unit |
+---------------------------+--------+-----+-----+-----+------+
| Supply current            |   Icc  |  -  |  -  |   5 |   mA |
+---------------------------+--------+-----+-----+-----+------+
| Input Voltage (low)       |    Vl  |   0 |  -  | 0.8 |    V |
+---------------------------+--------+-----+-----+-----+------+
| Input voltage (high)      |    Vh  | 3.5 |  -  | Vcc |    V |
+---------------------------+--------+-----+-----+-----+------+
| Input current R           |    Ih  |  -  |  -  | 100 |   uA |
+---------------------------+--------+-----+-----+-----+------+
| Input current Clk         |    Il  |  -  |  -  | 100 |   uA |
+---------------------------+--------+-----+-----+-----+------+
| Output current (Vol=0.5V) |   Iol  |  -  |  -  |  10 |   uA |
+---------------------------+--------+-----+-----+-----+------+
| Output current (Voh=5V)   |   Ioh  |  -  |  -  | 0.5 |   mA |
+---------------------------+--------+-----+-----+-----+------+

AC characteristics:
------------------     +--------+------+------+------+
		       | Symbol | Min. | Max. | Unit |
+----------------------+--------+------+------+------+
| Pulse duration       |    tr  |   50 |   -  |  us  |
| R address reset      |        |      |      |      |
+----------------------+--------+------+------+------+
| Pulse duration       |    ts  |   10 |   -  |  us  |
| R write              |        |      |      |      |
+----------------------+--------+------+------+------+
| High level Clk       |    th  |    8 |   -  |  us  |
+----------------------+--------+------+------+------+
| Low level Clk        |    tl  |   12 |   -  |  us  |
+----------------------+--------+------+------+------+
| Write window         | Twrite |   10 |   -  |  ms  |
+----------------------+--------+------+------+------+
| Erase window         | Terase |   10 |   -  |  ms  |
+----------------------+--------+------+------+------+
|                      |   tv1  |    5 |   -  |  us  |
+----------------------+--------+------+------+------+
|                      |   tv2  |  3.5 |   -  |  us  |
+----------------------+--------+------+------+------+
|                      |   tv3  |  3.5 |   -  |  us  |
+----------------------+--------+------+------+------+
|                      |   tv4  |  3.5 |   -  |  us  |
+----------------------+--------+------+------+------+
|                      |   tv5  |  3.5 |   -  |  us  |
+----------------------+--------+------+------+------+
|                      |   tv6  |    5 |   -  |  us  |
+----------------------+--------+------+------+------+
|                      |   tv7  |    5 |   -  |  us  |
+----------------------+--------+------+------+------+
|                      |   tv8  |   10 |   -  |  us  |
+----------------------+--------+------+------+------+



III) The Reader Schematic:
    ======================

   External 5V (Optional)

5V o------,
	  |                 /             T2  PNP      d13  r7 10
0V o--,   |                /               BC 177     |\ |  _____
      |   |      ,-------o/   o--*------. E      C .--| >+-[_____]--------,
    __+__ |      |               |       \        /   |/ |                |
    \\\\\ |    __|__ Battery     |         \    /                         |
	  |      -   22.5V       |       ---------                        |
.......   |      |               |   _____   |   _____                    |
       :  |    __+__             +--[_____]--*--[_____]--,                |
   D2  :  |    \\\\\                r6 150k     r5 15k   |                |
4 o-------|---------------------------*------------------|-------------,  |
       :  |                           |   r3 220k       / C            |  |
   Ack :  |                           |   _____      |/    T1 - NPN    |  |
10 o------|--------.                  '--[_____]-*---|      BC107      |  |
       :  |        |                      _____  |   |\                |  |
       : ,-,      ,-,                 +--[_____]-'      \ E            |  |
       : | |r2    | |r1               |  r4 390k         |             |  |
       : | |220   | |22k            __+__              __+__           |  |
       : |_|      |_|               \\\\\              \\\\\           |  |
       :  |  |\ |  |                                                   |  |
       :  *--| >+--|----------------*----------------------------------|--*
       :  |  |/ |  |          ,-----|-----------------------------,    |  |
       :  |  d1    |          |     |   ,----------,----------,   |    |  |
       :  |        |          |     *---|--*  Fuse | Reset *--|---'    |  |
       :  |        |          |     |   |----------|----------|        |  |
   D0  :  |        |          |   ,-|---|--*   I/O | Clk   *--|---,    |  |
2 o-------|--------|----------'   | |   |----------|----------|   |    |  |
       :  |        |              | '---|--*   Vpp | R/W   *--|---|----'  |
  Busy :  |        |              |     |----------|----------|   |       |
11 o------|--------|--------------' ,---|--*   Gnd | 5V    *  |   |       |
       :  |        |                |   '----------'-------|--'   |       |
   D1  :  |        |              __+__    Chip connector  |      |       |
3 o-------|--------|--------,     \\\\\                    |      |       |
       :  |        |        '------------------------------|------'       |
  Str  :  |  |\ |  |                                       |              |
1 o-------*--| >+--*----*----*----*----*-------------------'              |
       :   d2|/ |  |d3  |d4  |d5  |d6  |d7                                |
       :          -+-  -+-  -+-  -+-  -+-                                 |
       :          /_\  /_\  /_\  /_\  /_\                                 |
   D3  :           |    |    |    |    |   |\ | d8                        |
5 o----------------*----|----|----|----|---| >+-------*-------------------'
       :                |    |    |    |   |/ |       |
       :                |    |    |    |              |
   D4  :                |    |    |    |   |\ | d9    |
6 o---------------------*----|----|----|---| >+-------*
       :                     |    |    |   |/ |       |
       :                     |    |    |              |
   D5  :                     |    |    |   |\ | d10   |
7 o--------------------------*----|----|---| >+-------*
       :                          |    |   |/ |       |
       :                          |    |              |
   D6  :                          |    |   |\ | d11   |
8 o-------------------------------*----|---| >+-------*
       :                               |   |/ |       |
       :                               |              |
   D7  :                               |   |\ | d12   |
9 o------------------------------------*---| >+-------'
       :                                   |/ |
       :
       :
25 o------.
       :  |
.......:  |                                 d1 to d13: 1N4148
	__+__
	\\\\\