LIST P=16C84		;load\save with reset
;
COMWRIN		EQU 	B'10100000'
COMRDIN		EQU	B'10100001'
ADDRIN		EQU	B'10110000'

COMWROUT	EQU	B'10101100'
ADDR1		EQU	B'11001101'
ADDR2		EQU	B'11001110'
ADDR3		EQU	B'11001111'
ADDR4		EQU	B'11010000'

STATUS		EQU	03h
PORTB		EQU	06h
TRISB		EQU	06h
TMR0		EQU	01h
INTCON		EQU	0Bh

WRB		EQU	0Ch
REB		EQU	0Dh
CNTCIKL		EQU	0Eh
TIME		EQU	0Fh
TIME2		EQU	10H

DATA1		EQU	11h
DATA2		EQU	12h
DATA3		EQU	13h
DATA4		EQU	14h
FLAG		EQU	15h;
CNT		EQU	16h
COM		EQU	17h


	ORG	0

	MOVLW	32
	MOVWF	STATUS
	MOVLW	B'01011111'
	MOVWF	TRISB
	MOVLW	0
	MOVWF	STATUS

	CLRF	PORTB
	MOVLW	B'11010001'
	OPTION
	CLRF	COM
B0	CLRF	CNT

	BTFSS	PORTB,4
	GOTO	B2
B1	BTFSS	PORTB,4
	GOTO	B1
	GOTO	B3
B2	BTFSC	PORTB,4
	GOTO	B2
B3	CLRF	TMR0

	BSF	FLAG,0

A0	BTFSS	PORTB,4
	GOTO	A1

	BTFSC	FLAG,0
	GOTO	A2
	BCF	FLAG,0
	INCF	CNT,1
	GOTO	A2
	
A1	BTFSS	FLAG,0
	GOTO	A2
	BSF	FLAG,0
	INCF	CNT,1
	GOTO	A2	

A2	MOVLW	0C5h	;	3Ah
	ADDWF	TMR0,0
	BTFSS	STATUS,0
	GOTO	A3
	BTFSC	COM,1
	CALL	OUTP
		
A3	MOVLW	0A8h	;	57h
	ADDWF	TMR0,0
	BTFSS	STATUS,0
	GOTO	A4
	BTFSC	COM,0
	CALL	OUTP

A4	MOVLW	8Bh	;	74h
	ADDWF	TMR0,0
	BTFSS	STATUS,0
	GOTO	A5
	BTFSC	COM,1
	CALL	OUTP

A5	MOVLW	6Eh	;	91h
	ADDWF	TMR0,0
	BTFSS	STATUS,0
	GOTO	A0
	MOVF	CNT,0
	MOVWF	COM
	GOTO	B0

OUTP	MOVLW	B'00100000'
	XORWF	PORTB,1	
	RETURN






	MOVLW	0
	MOVWF	TMR0
M1	MOVLW	0E2h	;	1Dh
	ADDWF	TMR0,0
	BTFSS	STATUS,0
	GOTO	M1
	MOVLW	0
	MOVWF	TMR0
	COMF	FLAG,1
	BTFSS	FLAG,1
	GOTO	RES1
	GOTO	SET1
RES1	CALL	CLDRESE
	GOTO	M1
SET1	CALL	SETRESE		
	GOTO	M1
	GOTO	$








	CALL	CLDRESE
	CALL	TMLONG
	CALL	START
	MOVLW	COMWRIN
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDRIN
	MOVWF	WRB
	CALL	OUTI2C
	CALL	START
	MOVLW	COMRDIN
	MOVWF	WRB
	CALL	OUTI2C
	CALL	INI2C
	MOVF	REB,0
	MOVWF	DATA1
	CALL	INI2C
	MOVF	REB,0
	MOVWF	DATA2
	CALL	INI2C
	MOVF	REB,0
	MOVWF	DATA3
	CALL	INI2C
	MOVF	REB,0
	MOVWF	DATA4
	CALL	STOP
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR1
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA1,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR2
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA2,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR3
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA3,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP
	
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR4
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA4,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR1
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA1,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR2
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA2,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR3
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA3,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP
	
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR4
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA4,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TMLONG
	CALL	SETRESE
	GOTO	$
;--------------------------------------------------------------MAIN

OUTI2C	MOVLW	8
	MOVWF	CNTCIKL
CONOUT	BTFSC	WRB,7
	CALL	SETDAT
	CALL	TM
	CALL	SETSTR
	CALL	TM	
	CALL	CLDSTR
	CALL	TM
	CALL	CLDDAT
	RLF	WRB,1
	DECFSZ	CNTCIKL,1
	GOTO	CONOUT
	
	CALL	SETDAT
	CALL	TM
	CALL	SETSTR
	CALL	TM	
	CALL	CLDSTR
	CALL	TM
	CALL	CLDDAT
	CALL	TM
	RETURN
;--------OUT-------------------------------------------------OUT----------
INI2C	CLRF	REB
	MOVLW	8
	MOVWF	CNTCIKL
	CALL	SETDAT
	CALL	TM
	
CONIN	RLF	REB,1
	CALL	SETSTR
	CALL	TM
	BTFSC	PORTB,0
	BSF	REB,0		;WRITE LOW BIT TO REB
	CALL	CLDSTR
	CALL	TM
	DECFSZ	CNTCIKL,1
	GOTO	CONIN
	CALL	CLDDAT
	CALL	TM
	CALL	SETSTR	
	CALL	TM
	CALL	CLDSTR
	CALL	TM
	RETURN
;----------------IN------------------------------------------------IN-------
SETSTR	MOVLW	32
	MOVWF	STATUS
	BSF	TRISB,1
	MOVLW	0
	MOVWF	STATUS
	RETURN

CLDSTR	MOVLW	32
	MOVWF	STATUS
	BCF	TRISB,1
	MOVLW	0
	MOVWF	STATUS
	RETURN

SETDAT	MOVLW	32
	MOVWF	STATUS
	BSF	TRISB,0
	MOVLW	0
	MOVWF	STATUS
	RETURN

CLDDAT	MOVLW	32
	MOVWF	STATUS
	BCF	TRISB,0
	MOVLW	0
	MOVWF	STATUS
	RETURN

SETRESE	MOVLW	32
	MOVWF	STATUS
	BSF	TRISB,3
	MOVLW	0
	MOVWF	STATUS
	RETURN

CLDRESE	MOVLW	32
	MOVWF	STATUS
	BCF	TRISB,3
	MOVLW	0
	MOVWF	STATUS
	RETURN


;-----------------PORT-------------------------------------------------------
;BEGIN	CALL	TMLONG
;	CALL	TMLONG
;	CALL	TMLONG
;	CALL	TMLONG
;	CALL	TMLONG
;	CALL	TMLONG
;	CALL	TMLONG
;	CALL	TMLONG
;	CALL	TMLONG
;	CALL	TMLONG
;BEGI	CALL	TMLONG
;
;	MOVLW	0FFh
;	MOVWF	CNTCIKL
;CONBEG	CALL	TM
;	CALL	TM
;	BTFSC	PORTB,2
;	GOTO	BEGI
;	DECFSZ	CNTCIKL,1
;	GOTO	CONBEG
;	CALL	RESET
;	RETURN
;-------------------BEGIN----------------------------------------------------
START	CALL	SETDAT
	CALL	TM
	CALL	SETSTR
	CALL	TM
	CALL	CLDDAT
	CALL	TM
	CALL	CLDSTR
	CALL	TM
	RETURN
;-------------------START---------------------------------------------------
STOP	CALL	SETSTR
	CALL	TM
	CALL	SETDAT
	CALL	TM
	RETURN
;---------------------STOP---------------------------------------------------	
TM	MOVLW	0AFh
	MOVWF	TIME
LL3	DECFSZ	TIME,1
	GOTO	LL3
	RETURN
;----------------------TM----------------------------------------------------


TMLONG	MOVLW	0FFH
	MOVWF	TIME
LL1	MOVLW	0FFH
	MOVWF	TIME2
LL2	DECFSZ	TIME2,1
	GOTO	LL2	

	DECFSZ	TIME,1
	GOTO	LL1
	RETURN	
;----------------------TMLONG-----------------------------------------------
end
;          
