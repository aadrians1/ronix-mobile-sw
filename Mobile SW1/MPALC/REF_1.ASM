LIST P=16C84		;surogat ZC 98302 FU
;
DATA1		EQU 		B'11100000'	;
DATA2		EQU		B'00000011'	;
DATA3		EQU		B'11100001'	;

DATA4		EQU	B'00000111'	;00000100		
DATA5		EQU	B'11111011'	;B'10001100'	;10ЧислоМ
DATA6		EQU	B'01110111'	;B'00110111'	;есяГод__	
DATA7		EQU	B'10110101'	;B'10001011'	;__######	
DATA8		EQU	B'11001010'	;B'11111001'	;########	
DATA9		EQU	B'11111000'	;B'01001011'	;????????	

STATUS		EQU	03h
PORTB		EQU	06h
TRISB		EQU	06h

PARM		EQU	0Ch
CNTB		EQU	0Dh
FLAG		EQU	0Eh

BEGIN	ORG	0
	CLRF	PORTB
	CALL	SETS
	CALL	SETD
	CALL	WSTART
	MOVLW	DATA1
	MOVWF	PARM
	CALL	SOUT
	MOVLW	DATA2
	MOVWF	PARM
	CALL	SOUT
	CALL	WSTART
	MOVLW	DATA3
	MOVWF	PARM
	CALL	SOUT

	CALL	SETD
	CALL	SETD
	CALL	SETD
	CALL	SETD
	CALL	SETD
	CALL	SETD
	CALL	SETD
	CALL	SETD

	CALL	RESD

	MOVLW	DATA4
	MOVWF	PARM
	CALL	SOUT
	MOVLW	DATA5
	MOVWF	PARM
	CALL	SOUT
	MOVLW	DATA6
	MOVWF	PARM
	CALL	SOUT
	MOVLW	DATA7
	MOVWF	PARM
	CALL	SOUT
	MOVLW	DATA8
	MOVWF	PARM
	CALL	SOUT
	MOVLW	DATA9
	MOVWF	PARM
	CALL	LAST
PEND	CALL	SETS
	CALL	SETD
	SLEEP
	BSF	PORTB,5
	GOTO	PEND

SOUT	MOVLW	8
	MOVWF	CNTB
SO1	BTFSC	PARM,7		
	CALL	SETD
	BTFSS	PARM,7
	CALL	RESD
	RLF	PARM,1

SO2	BTFSS	PORTB,4
	GOTO	SO2
SO3	BTFSC	PORTB,4
	GOTO	SO3
	DECFSZ	CNTB,1
	GOTO	SO1

	CALL	SETD
	CALL	SETD
	CALL	SETD
	CALL	RESD

SO4	BTFSS	PORTB,4
	GOTO	SO4
SO5	BTFSC	PORTB,4
	GOTO	SO5

	RETURN	

LAST	MOVLW	8
	MOVWF	CNTB
LA1	BTFSC	PARM,7		
	CALL	SETD
	BTFSS	PARM,7
	CALL	RESD
	RLF	PARM,1

LA2	BTFSS	PORTB,4
	GOTO	LA2
LA3	BTFSC	PORTB,4
	GOTO	LA3
	DECFSZ	CNTB,1
	GOTO	LA1
	
;	CALL	RESD
	CALL	SETD

LAA2	BTFSS	PORTB,4
	GOTO	LAA2
LAA3	BTFSC	PORTB,4
	GOTO	LAA3
	RETURN


	


;------------------------WAIT START CONDITION---------
WSTART	CLRF	FLAG
	MOVLW	0FFh	
	TRIS	TRISB
ST1	BTFSC	PORTB,5		;analiz DATA
	GOTO	ST1
	BTFSC	PORTB,4		;analiz STROB
	GOTO	ST2
	BTFSS	FLAG,1		;analiz START CONDITION
	GOTO	ST1
	CALL	RESD
	RETURN

ST2	MOVLW	0FFh
	MOVWF	FLAG
	GOTO	ST1

;----------------OUT------------------
SETS	MOVLW	32
	MOVWF	STATUS
	BSF	TRISB,4
	MOVLW	0
	MOVWF	STATUS
	RETURN

SETD	MOVLW	32
	MOVWF	STATUS
	BSF	TRISB,5
	MOVLW	0
	MOVWF	STATUS
	RETURN

RESD	MOVLW	32
	MOVWF	STATUS
	BCF	TRISB,5
	MOVLW	0
	MOVWF	STATUS
	RETURN

END