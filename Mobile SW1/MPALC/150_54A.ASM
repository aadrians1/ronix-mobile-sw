LIST P=16C54		;load\save with reset
;
COMWRIN		EQU 	B'10100000'
COMRDIN		EQU	B'10100001'
ADDRIN		EQU	B'10110000'

COMWROUT	EQU	B'10101100'
ADDR1		EQU	B'11001101'
ADDR2		EQU	B'11001110'
ADDR3		EQU	B'11001111'
ADDR4		EQU	B'11010000'

STATUS		EQU	03h
PORTB		EQU	06h
FSR		EQU	04h

TIME		EQU	07h	;07h(FOR 16C54A)
TMPF		EQU	08h
CNTCIKL		EQU	09h
WRB		EQU	0Ah
REB		EQU	0Bh

DATA1		EQU	0Ch
DATA2		EQU	0Dh
DATA3		EQU	0Eh
DATA4		EQU	0Fh

	ORG	0
	CALL	TM
	MOVLW	0FFh
	MOVWF	TMPF
	TRIS	PORTB
	CLRF	PORTB
	CALL	CLDRESE

	CALL	TM
	CALL	TM
	CALL	TM

	CALL	START
	MOVLW	COMWRIN
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDRIN
	MOVWF	WRB
	CALL	OUTI2C
	CALL	START
	MOVLW	COMRDIN
	MOVWF	WRB
	CALL	OUTI2C

	CALL	INI2C
	MOVFW	REB
	MOVWF	DATA1	
	CALL	INI2C
	MOVFW	REB
	MOVWF	DATA2
	CALL	INI2C
	MOVFW	REB
	MOVWF	DATA3
	CALL	INI2C
	MOVFW	REB
	MOVWF	DATA4
	CALL	STOP

	CALL	TM
	CALL	TM
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR1
	MOVWF	WRB
	CALL	OUTI2C
	MOVFW	DATA1
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM
	CALL	TM
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR2
	MOVWF	WRB
	CALL	OUTI2C
	MOVFW	DATA2
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM
	CALL	TM
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR3
	MOVWF	WRB
	CALL	OUTI2C
	MOVFW	DATA3
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP
	
	CALL	TM
	CALL	TM
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR4
	MOVWF	WRB
	CALL	OUTI2C
	MOVFW	DATA4
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM
	CALL	TM
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR1
	MOVWF	WRB
	CALL	OUTI2C
	MOVFW	DATA1
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM
	CALL	TM
	CALL	TM

	CALL	SETRESE

	GOTO	$
;--------------------------------------------------------------MAIN

OUTI2C	MOVLW	8
	MOVWF	CNTCIKL
CONOUT	BTFSC	WRB,7
	CALL	SETDAT
	CALL	TM
	CALL	SETSTR
	CALL	TM	
	CALL	CLDSTR
	CALL	TM
	CALL	CLDDAT
	RLF	WRB,1
	DECFSZ	CNTCIKL,1
	GOTO	CONOUT
	
	CALL	SETDAT
	CALL	TM
	CALL	SETSTR
	CALL	TM	
	CALL	CLDSTR
	CALL	TM
	CALL	CLDDAT
	CALL	TM
	RETLW	0
;--------OUT-------------------------------------------------OUT----------
INI2C	MOVLW	8
	MOVWF	CNTCIKL
	CALL	SETDAT
	CALL	TM
	CLRF	REB
	RLF	REB,1
	CLRF	REB	

CONIN	RLF	REB,1
	CALL	SETSTR
	CALL	TM
	BTFSC	PORTB,0
	BSF	REB,0		;WRITE LOW BIT TO REB
	BTFSS	PORTB,0
	BCF	REB,0
	CALL	CLDSTR
	CALL	TM
	DECFSZ	CNTCIKL,1
	GOTO	CONIN
	CALL	CLDDAT
	CALL	TM
	CALL	SETSTR	
	CALL	TM
	CALL	CLDSTR
	CALL	TM
	RETLW	0
;----------------IN------------------------------------------------IN-------
SETSTR	BSF	TMPF,1
	MOVFW	TMPF
	TRIS	PORTB
	RETLW	0

CLDSTR	BCF	TMPF,1
	MOVFW	TMPF
	TRIS	PORTB
	RETLW	0

SETDAT	BSF	TMPF,0
	MOVFW	TMPF
	TRIS	PORTB
	RETLW	0

CLDDAT	BCF	TMPF,0
	MOVFW	TMPF
	TRIS	PORTB
	RETLW	0

SETRESE	BSF	TMPF,3
	BSF	TMPF,2
	MOVFW	TMPF
	TRIS	PORTB
	RETLW	0

CLDRESE	BCF	TMPF,3
	BCF	TMPF,2
	MOVFW	TMPF
	TRIS	PORTB
	RETLW	0


;-------------------BEGIN----------------------------------------------------
START	CALL	SETDAT
	CALL	TM
	CALL	SETSTR
	CALL	TM
	CALL	CLDDAT
	CALL	TM
	CALL	CLDSTR
	CALL	TM
	RETLW	0
;-------------------START---------------------------------------------------
STOP	CALL	SETSTR
	CALL	TM
	CALL	SETDAT
	CALL	TM
	RETLW	0
;---------------------STOP---------------------------------------------------	
TM	MOVLW	0FFh
	MOVWF	TIME
LL3	DECFSZ	TIME,1
	GOTO	LL3
	RETLW	0
;----------------------TM----------------------------------------------------

end
;          
