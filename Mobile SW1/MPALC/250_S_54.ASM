LIST P=16C54		;load\save with reset for N-250 (SIS)
;
COMWRIN		EQU 	B'10100110'
COMRDIN		EQU	B'10100111'
ADDRIN		EQU	B'11110000'

COMWROUT	EQU	B'10101000'
ADDR1		EQU	B'01111010'
ADDR2		EQU	B'01111011'
ADDR3		EQU	B'01111100'
ADDR4		EQU	B'01111101'
ADDR5		EQU	B'01111110'
ADDR6		EQU	B'01111111'

STATUS		EQU	03h
PORTB		EQU	06h
TRISB		EQU	06h

WRB		EQU	07h
REB		EQU	08h
CNTCIKL		EQU	09h
TIME		EQU	0Ah
TIME2		EQU	0BH

DATA1		EQU	0Ch
DATA2		EQU	0Dh
DATA3		EQU	0Eh
DATA4		EQU	0Fh
DATA5		EQU	10h

	ORG	0
	CLRF	PORTB
	CALL	CLDRESE
	CALL	TMLONG
	CALL	START
	MOVLW	COMWRIN
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDRIN
	MOVWF	WRB
	CALL	OUTI2C
	CALL	START
	MOVLW	COMRDIN
	MOVWF	WRB
	CALL	OUTI2C
	CALL	INI2C
	MOVF	REB,0
	MOVWF	DATA1
	CALL	INI2C
	MOVF	REB,0
	MOVWF	DATA2
	CALL	INI2C
	MOVF	REB,0
	MOVWF	DATA3
	CALL	INI2C
	MOVF	REB,0
	MOVWF	DATA4
	CALL	INI2C
	MOVF	REB,0
	MOVWF	DATA5
	CALL	STOP
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR1
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA1,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR2
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA2,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR3
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA3,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP
	
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR4
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA4,0
	ANDLW	0F0h
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR1
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA1,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR2
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA2,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR3
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA3,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP
	
	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR4
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA4,0
	ANDLW	0F0h
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR5
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA4,0
	ANDLW	0Fh
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TM

	CALL	START
	MOVLW	COMWROUT		
	MOVWF	WRB
	CALL	OUTI2C
	MOVLW	ADDR6
	MOVWF	WRB
	CALL	OUTI2C
	MOVF	DATA5,0
	MOVWF	WRB
	CALL	OUTI2C
	CALL	STOP

	CALL	TMLONG
	CALL	SETRESE
	GOTO	$
;--------------------------------------------------------------MAIN

OUTI2C	MOVLW	8
	MOVWF	CNTCIKL
CONOUT	BTFSC	WRB,7
	CALL	SETDAT

	MOVLW	0AFh
TM1	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TM1

	CALL	SETSTR
	
	MOVLW	0AFh
TM2	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TM2
	
	CALL	CLDSTR

	MOVLW	0AFh
TM3	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TM3

	CALL	CLDDAT
	RLF	WRB,1
	DECFSZ	CNTCIKL,1
	GOTO	CONOUT
	
	CALL	SETDAT
	
	MOVLW	0AFh
TM4	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TM4

	CALL	SETSTR
	
	MOVLW	0AFh
TM5	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TM5
	
	CALL	CLDSTR

	MOVLW	0AFh
TM6	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TM6

	CALL	CLDDAT
	
	MOVLW	0AFh
TM7	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TM7
	RETLW	0
;--------OUT-------------------------------------------------OUT----------
INI2C	CLRF	REB
	MOVLW	8
	MOVWF	CNTCIKL
	CALL	SETDAT
	MOVLW	0AFh
TTM1	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TTM1
	
	
CONIN	RLF	REB,1
	CALL	SETSTR
	
	MOVLW	0AFh
TTM2	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TTM2

	BTFSC	PORTB,0
	BSF	REB,0		;WRITE LOW BIT TO REB
	CALL	CLDSTR
	
	MOVLW	0AFh
TTM3	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TTM3

	DECFSZ	CNTCIKL,1
	GOTO	CONIN
	CALL	CLDDAT
	
	MOVLW	0AFh
TTM4	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TTM4

	CALL	SETSTR	
	
	MOVLW	0AFh
TTM5	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TTM5

	CALL	CLDSTR
	
	MOVLW	0AFh
TTM6	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TTM6

	RETLW	0
;----------------IN------------------------------------------------IN-------
SETSTR	MOVLW	32
	MOVWF	STATUS
	BSF	TRISB,1
	MOVLW	0
	MOVWF	STATUS
	RETLW	0

CLDSTR	MOVLW	32
	MOVWF	STATUS
	BCF	TRISB,1
	MOVLW	0
	MOVWF	STATUS
	RETLW	0

SETDAT	MOVLW	32
	MOVWF	STATUS
	BSF	TRISB,0
	MOVLW	0
	MOVWF	STATUS
	RETLW	0

CLDDAT	MOVLW	32
	MOVWF	STATUS
	BCF	TRISB,0
	MOVLW	0
	MOVWF	STATUS
	RETLW	0

SETRESE	MOVLW	32
	MOVWF	STATUS
	BSF	TRISB,3
	MOVLW	0
	MOVWF	STATUS
	RETLW	0

CLDRESE	MOVLW	32
	MOVWF	STATUS
	BCF	TRISB,3
	MOVLW	0
	MOVWF	STATUS
	RETLW	0


START	CALL	SETDAT
	CALL	TM
	CALL	SETSTR
	CALL	TM
	CALL	CLDDAT
	CALL	TM
	CALL	CLDSTR
	CALL	TM
	RETLW	0
;-------------------START---------------------------------------------------
STOP	CALL	SETSTR
	CALL	TM
	CALL	SETDAT
	CALL	TM
	RETLW	0
;---------------------STOP---------------------------------------------------	
TM	MOVLW	0AFh
TTTM	MOVWF	TIME
	DECFSZ	TIME,1
	GOTO	TTTM
	RETLW	0
;----------------------TM----------------------------------------------------


TMLONG	MOVLW	0FFH
	MOVWF	TIME
LL1	MOVLW	0FFH
	MOVWF	TIME2
LL2	DECFSZ	TIME2,1
	GOTO	LL2	

	DECFSZ	TIME,1
	GOTO	LL1
	RETLW	0	
;----------------------TMLONG-----------------------------------------------
end
;          
