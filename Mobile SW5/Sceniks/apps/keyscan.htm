<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage Express 2.0">
<title>Scenix Semiconductor, Inc. - Support</title>
<!-- macro support_header start -->
</head>

<body background="/gifs/bg.gif" text="#000000" link="#006699"
vlink="#006342" onload="defaultStatus=''">
<script language="JavaScript">

       if (document.images) {            
       img1on = new Image();   img1on.src = "/gifs/home2.gif";  
       img2on = new Image();   img2on.src = "/gifs/search2.gif";
       img3on = new Image();   img3on.src = "/gifs/sitemap2.gif";
       img4on = new Image();   img4on.src = "/gifs/feedback2.gif";
       img1off = new Image();  img1off.src = "/gifs/home1.gif";
       img2off = new Image();  img2off.src = "/gifs/search1.gif";
       img3off = new Image();  img3off.src = "/gifs/sitemap1.gif";
       img4off = new Image();  img4off.src = "/gifs/feedback1.gif";
       }

    function imgOn(imgName) {
            if (document.images) {
                document[imgName].src = eval(imgName + "on.src");       
            }
    }

    function imgOff(imgName) {
            if (document.images) {
                document[imgName].src = eval(imgName + "off.src");        
            }
    }
// -->
</script>

<table border="0" cellpadding="0" cellspacing="0" width="630">
    <tr>
        <td align="center" valign="top" width="115"><a
        href="/index.html"><img src="/gifs/sxlogo.gif"
        alt="Scenix Logo" border="0" width="78" height="71"></a></td>
        <td align="right" valign="top"><nobr><img
        src="/gifs/scenix.gif" alt="Scenix Banner" width="269"
        height="28"></nobr><a href="/index.html"><nobr></a><a
        href="/index.html"><img src="/gifs/home1.gif" alt="Home"
        border="0" width="52" height="28" name="img1"></a><a
        href="/index.html"></nobr></a><a
        href="/support/search/index.html"><nobr></a><a
        href="/support/search/index.html"><img
        src="/gifs/search1.gif" alt="Search" border="0"
        width="52" height="28" name="img2"></a><a
        href="/support/search/index.html"></nobr></a><a
        href="/search/sitemap.html"><nobr></a><a
        href="/search/sitemap.html"><img src="/gifs/sitemap1.gif"
        alt="Sitemap" border="0" width="58" height="28"
        name="img3"></a><a href="/search/sitemap.html"></nobr></a><a
        href="/support/feedback/index.html"><nobr></a><a
        href="/support/feedback/index.html"><img
        src="/gifs/feedback1.gif" alt="Contact" border="0"
        width="58" height="28" name="img4"></a><a
        href="/support/feedback/index.html"></nobr></a><br>
        <p><nobr><img src="/gifs/support.gif" alt="Support" width="244"
        height="42"><img src="/gifs/img.gif" alt="Circuit Board"
        width="228" height="42"></nobr></p>
        </td>
    </tr>
    <tr>
        <td align="center" valign="top" width="112"><applet
        code="ime" codebase="/java" align="baseline" width="112"
        height="350"><param name="Notice"
        value="Infinite Menus, Copyright (c) 1998, OpenCube Inc."><param
        name="bgcolor" value="255,255,255"><param name="onsbtext"
        value="Cost Effective Microcontrollers"><param
        name="offsbtext" value="Scenix Semiconductor, Inc."><param
        name="bgxy" value="0,0"><param name="font"
        value="Helvetica,Bold,11"><param name="menutextcolor"
        value="8,0,2"><param name="lrmargin" value="5"><param
        name="halign" value="left"><param name="menucolor"
        value="180,222,242"><param name="menuoutlinecolor"
        value="0,0,0"><param name="menuhlcolor"
        value="66,128,163"><param name="menuhltextcolor"
        value="0,0,0"><param name="loadwhere" value="_self"><param
        name="imagefile0" value="/gifs/company1.gif"><param
        name="imagexy0" value="0,10"><param name="switchfile0"
        value="/gifs/company2.gif"><param name="imagedesturl0"
        value="http://www.scenix.com/company/index.html"><param
        name="imagefile1" value="/gifs/products1.gif"><param
        name="imagexy1" value="0,40"><param name="switchfile1"
        value="/gifs/products2.gif"><param name="imagedesturl1"
        value="http://www.scenix.com/products/index.html"><param
        name="imagefile2" value="/gifs/tools1.gif"><param
        name="imagexy2" value="0,70"><param name="switchfile2"
        value="/gifs/tools2.gif"><param name="imagedesturl2"
        value="http://www.scenix.com/tools/index.html"><param
        name="imagefile3" value="/gifs/virtual1.gif"><param
        name="imagexy3" value="0,100"><param name="switchfile3"
        value="/gifs/virtual2.gif"><param name="imagedesturl3"
        value="http://www.scenix.com/virtual/index.html"><param
        name="imagefile4" value="/gifs/news1.gif"><param
        name="imagexy4" value="0,130"><param name="switchfile4"
        value="/gifs/news2.gif"><param name="imagedesturl4"
        value="http://www.scenix.com/news/index.html"><param
        name="imagefile5" value="/gifs/support2.gif"><param
        name="imagexy5" value="0,160"><param name="switchfile5"
        value="/gifs/support1.gif"><param name="imagedesturl5"
        value="http://www.scenix.com/support/index.html"><param
        name="imagefile6" value="/gifs/partners1.gif"><param
        name="imagexy6" value="0,190"><param name="switchfile6"
        value="/gifs/partners2.gif"><param name="imagedesturl6"
        value="http://www.scenix.com/partners/index.html"><param
        name="imagefile7" value="/gifs/sales1.gif"><param
        name="imagexy7" value="0,220"><param name="switchfile7"
        value="/gifs/sales2.gif"><param name="imagedesturl7"
        value="http://www.scenix.com/sales/index.html"><param
        name="imagefile8" value="/gifs/jobs1.gif"><param
        name="imagexy8" value="0,250"><param name="switchfile8"
        value="/gifs/jobs2.gif"><param name="imagedesturl8"
        value="http://www.scenix.com/jobs/index.html"><param
        name="desc0-0" value="Background"><param
        name="desturl0-0"
        value="http://www.scenix.com/company/background/index.html"><param
        name="loadwhere0-0" value="_self"><param name="desc0-1"
        value="Team"><param name="desturl0-1"
        value="http://www.scenix.com/company/management/index.html"><param
        name="loadwhere0-1" value="_self"><param name="desc0-2"
        value="FAQs"><param name="desturl0-2"
        value="http://www.scenix.com/company/faq/index.html"><param
        name="loadwhere0-2" value="_self"><param name="desc0-3"
        value="Contact"><param name="desturl0-3"
        value="http://www.scenix.com/company/contact/index.html"><param
        name="loadwhere0-3" value="_self"><param name="desc0-4"
        value="Directions"><param name="desturl0-4"
        value="http://www.scenix.com/company/directions/index.html"><param
        name="loadwhere0-4" value="_self"><param name="desc1-0"
        value="Datasheets"><param name="desturl1-0"
        value="http://www.scenix.com/products/datasheets/index.html"><param
        name="loadwhere1-0" value="_self"><param name="desc1-1"
        value="Briefs"><param name="desturl1-1"
        value="http://www.scenix.com/products/briefs/index.html"><param
        name="loadwhere1-1" value="_self"><param name="desc1-2"
        value="Quick Tour"><param name="desturl1-2"
        value="http://www.scenix.com/products/quicktour/index.html"><param
        name="loadwhere1-2" value="_self"><param name="desc1-3"
        value="Mailing List"><param name="desturl1-3"
        value="http://www.scenix.com/products/mailing/index.html"><param
        name="loadwhere1-3" value="_self"><param name="desc1-4"
        value="Sucesses"><param name="desturl1-4"
        value="http://www.scenix.com/products/success/index.html"><param
        name="loadwhere1-4" value="_self"><param name="desc1-5"
        value="Feedback"><param name="desturl1-5"
        value="http://www.scenix.com/products/feedback/index.html"><param
        name="loadwhere1-5" value="_self"><param name="desc3-0"
        value="Tested"><param name="desturl3-0"
        value="http://www.scenix.com/virtual/tested/index.html"><param
        name="loadwhere3-0" value="_self"><param name="desc3-1"
        value="Untested"><param name="desturl3-1"
        value="http://www.scenix.com/virtual/untested/index.html"><param
        name="loadwhere3-1" value="_self"><param name="desc3-2"
        value="Feedback"><param name="desturl3-2"
        value="http://www.scenix.com/virtual/feedback/index.html"><param
        name="loadwhere3-2" value="_self"><param name="desc4-0"
        value="Press"><param name="desturl4-0"
        value="http://www.scenix.com/news/press/index.html"><param
        name="loadwhere4-0" value="_self"><param name="desc4-1"
        value="Articles"><param name="desturl4-1"
        value="http://www.scenix.com/news/articles/index.html"><param
        name="loadwhere4-1" value="_self"><param name="desc4-2"
        value="Analysts Kit"><param name="desturl4-2"
        value="http://www.scenix.com/news/analysts/index.html"><param
        name="loadwhere4-2" value="_self"><param name="desc4-3"
        value="Press Kit"><param name="desturl4-3"
        value="http://www.scenix.com/news/presskit/index.html"><param
        name="loadwhere4-3" value="_self"><param name="desc4-4"
        value="White Papers"><param name="desturl4-4"
        value="http://www.scenix.com/news/wpapers/index.html"><param
        name="loadwhere4-4" value="_self"><param name="desc4-5"
        value="Sucesses"><param name="desturl4-5"
        value="http://www.scenix.com/news/success/index.html"><param
        name="loadwhere4-5" value="_self"><param name="desc5-0"
        value="Training"><param name="desturl5-0"
        value="http://www.scenix.com/support/training/index.html"><param
        name="loadwhere5-0" value="_self"><param name="desc5-1"
        value="Newsgroups"><param name="desturl5-1"
        value="http://www.scenix.com/support/bbs/index.html"><param
        name="loadwhere5-1" value="_self"><param name="desc5-2"
        value="Manuals"><param name="desturl5-2"
        value="http://www.scenix.com/support/manuals/index.html"><param
        name="loadwhere5-2" value="_self"><param name="desc5-3"
        value="FAQs"><param name="desturl5-3"
        value="http://www.scenix.com/support/faq/index.html"><param
        name="loadwhere5-3" value="_self"><param name="desc5-4"
        value="Errata"><param name="desturl5-4"
        value="http://www.scenix.com/support/errata/index.html"><param
        name="loadwhere5-4" value="_self"><param name="desc5-5"
        value="Suggestions"><param name="desturl5-5"
        value="http://www.scenix.com/support/box/index.html"><param
        name="loadwhere5-5" value="_self"><param name="desc5-6"
        value="App Notes"><param name="desturl5-6"
        value="http://www.scenix.com/support/appnotes/index.html"><param
        name="loadwhere5-6" value="_self"><param name="desc5-7"
        value="Search"><param name="desturl5-7"
        value="http://www.scenix.com/support/search/index.html"><param
        name="loadwhere5-7" value="_self"><param name="desc5-8"
        value="Links"><param name="desturl5-8"
        value="http://www.scenix.com/support/links/index.html"><param
        name="loadwhere5-8" value="_self"><param name="desc5-9"
        value="Contact"><param name="desturl5-9"
        value="http://www.scenix.com/support/contact/index.html"><param
        name="loadwhere5-9" value="_self"><param name="desc6-0"
        value="Tools"><param name="desturl6-0"
        value="http://www.scenix.com/partners/tools/index.html"><param
        name="loadwhere6-0" value="_self"><param name="desc6-1"
        value="Consultants"><param name="desturl6-1"
        value="http://www.scenix.com/partners/consultants/index.html"><param
        name="loadwhere6-1" value="_self"><param name="desc6-2"
        value="Links"><param name="desturl6-2"
        value="http://www.scenix.com/partners/links/index.html"><param
        name="loadwhere6-2" value="_self"><param name="desc6-3"
        value="Successes"><param name="desturl6-3"
        value="http://www.scenix.com/partners/success/index.html"><param
        name="loadwhere6-3" value="_self"><param name="desc7-0"
        value="Consultants"><param name="desturl7-0"
        value="http://www.scenix.com/sales/consultants/index.html"><param
        name="loadwhere7-0" value="_self"><param name="desc7-1"
        value="Tools"><param name="desturl7-1"
        value="http://www.scenix.com/sales/tools/index.html"><param
        name="loadwhere7-1" value="_self"><param name="desc7-2"
        value="Sales Reps"><param name="desturl7-2"
        value="http://www.scenix.com/sales/reps/index.html"><param
        name="loadwhere7-2" value="_self"><param name="desc7-3"
        value="Contact"><param name="desturl7-3"
        value="http://www.scenix.com/sales/contact/index.html"><param
        name="loadwhere7-3" value="_self"><param name="desc8-0"
        value="Listings"><param name="desturl8-0"
        value="http://www.scenix.com/jobs/listing/index.html"><param
        name="loadwhere8-0" value="_self"><param name="desc8-1"
        value="Send Resume"><param name="desturl8-1"
        value="http://www.scenix.com/jobs/resume/index.html"><param
        name="loadwhere8-1" value="_self"><!--TAG GENERATOR: OpenCube - Applet Composer, (www.opencube.com)--><!--OpenCube Copyright Notice Parameter--><!--General / Default Settings--><!--Specific Settings--></applet> </td>
        <td valign="top"><br>
<!-- macro support_header stop -->        <table border="0" cellpadding="10" width="85%">
            <tr>
                <td><h2 align="center">A Virtual Peripheral
                Keyboard Scanner</h2>
                </td>
            </tr>
            <tr>
                <td><b><u>Introduction</u></b><br>
                <br>
                This application note presents programming
                techniques for scanning a 4x4 keyboard usually
                found in both consumer and industrial
                applications for simple numeric data entry. This
                implementation uses the SX's internal interrupt
                feature to allow background operation of the code
                as a virtual peripheral, uses the Parallax demo
                board and the internal pull-up capability of SX
                ports to eliminate the need of any external
                components.</td>
            </tr>
            <tr>
                <td><p align="center"><img src="keyscan1.gif"
                width="318" height="263"></p>
                </td>
            </tr>
            <tr>
                <td><b><u>How the circuit and program work</u></b><br>
                <br>
                The circuit is just a simple connection to a
                keyboard matrix as indicated. Note that only 10
                out of 16 positions are used. All 16 positions
                can be used by simply altering the virtual
                keyboard matrix, which assigns value to the key
                pressed according to their row and column
                positions. No external resistors are used due to
                the capabilities of SX to have internal weak pull
                up in the range of 20K. (Note: for Parallax demo
                board users, the connection to R13 for LED drive
                must be clipped off or disconnected since it will
                create a pull down effect.)</td>
            </tr>
            <tr>
                <td>The interrupt code segment uses a state
                machine approach to scan the keyboard so as not
                to tie up the CPU for a long time during keyboard
                scan.</td>
            </tr>
            <tr>
                <td><u>Flowchart for main loop</u></td>
            </tr>
            <tr>
                <td><p align="center"><img src="keyscan2.gif"
                width="204" height="337"></p>
                </td>
            </tr>
            <tr>
                <td><u>State diagram of interrupt routine</u></td>
            </tr>
            <tr>
                <td><p align="center"><img src="keyscan3.gif"
                width="591" height="344"></p>
                </td>
            </tr>
            <tr>
                <td>In the main program, bit 4-7 of port B are
                initialized as inputs with Schmitt-trigger and
                pull-ups while bit 3-0 are configure as outputs.
                Scanning is accomplished by outputting a zero on
                a column. If any key on that column is pressed, a
                zero will be read in the row where that key is
                located. Due to the internal pull-ups, all
                inactive inputs will be read as '1's.</td>
            </tr>
            <tr>
                <td>The RTCC is initialized to be incremented on
                internal clock cycles. With a prescaler ratio of
                8, coupled with a value of 250 in the RETIW
                interrupt routine which will be loaded into RTCC,
                it will give us approximately 1 mS per interrupt.</td>
            </tr>
            <tr>
                <td>The state machine is initialized to start
                with fast scan which output zeroes to all columns
                and detect all keys at the same time. Once any
                key is detected, debouncing will be started.
                Normally this is dependent on the mechanical
                characteristics of the keys. In this case, we are
                using a 20 mS debouncing time.</td>
            </tr>
            <tr>
                <td>After debouncing is done, a detailed scanning
                will be done. Each column will have a zero output
                at a time to detect if any key in that certain
                column is pressed. If that is the case, a value
                other than 11110000 (binary) will be read from
                the inputs (RB4-7) and we will know that a key is
                pressed. Otherwise, the detection that we made
                from the fast scan stage may just have been noise
                and we transition back to fast scan state.</td>
            </tr>
            <tr>
                <td>When a value other than 11110000 (binary) is
                read, then we use that value to find out on which
                row the key is. That row count and the column
                count that we keep during column scan will give
                us the exact location of the key hit by the
                formula:</td>
            </tr>
            <tr>
                <td>index to virtual matrix = 4*row count +
                column count</td>
            </tr>
            <tr>
                <td><p align="center"><img src="keyscan4.gif"
                width="535" height="287"></p>
                </td>
            </tr>
            <tr>
                <td>Note: Index to virtual matrix is indicated at
                each intersection.</TD.> </td>
            </tr>
            <tr>
                <td>Encoding is done by simply loading the value
                in the virtual matrix table using the IREAD
                instruction. This enables us to easily change the
                encoded value and adapt to different keyboard
                layouts.</td>
            </tr>
            <tr>
                <td>After encoding, the interrupt routine will
                transition to fast scan state when the key is
                released. This is to ensure that single key press
                will not be detected as multiple key strokes.</td>
            </tr>
            <tr>
                <td><b><u>Modifications and further options</u></b><br>
                <br>
                To accommodate a different 4 x 4 keyboard layout,
                it is very easy to just change the virtual
                matrix. The first entry is for index 0 and the
                last entry is for the index value of 0F (hex).</td>
            </tr>
            <tr>
                <td>Notice that all values are negated to enable
                display on LED on port B. A zero causes the LED
                to be lit and an one will turn it off. If
                desired, the ~ sign can be removed to obtain the
                true value.</td>
            </tr>
            <tr>
                <td>For example, the following matrix can be used
                for a 4 x 4 hexadecimal keyboard with real value
                (not display value):</td>
            </tr>
            <tr>
                <td><table border="0" cellspacing="15">
                    <tr>
                        <td>virtual matrix</td>
                        <td>dw</td>
                        <td>$F</td>
                        <td>; bottom right</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>$E</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>$D</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>$C</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>$B</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>$A</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>9 </td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>8 </td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>7 </td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>6</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>5</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>4</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>3</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>2</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>dw</td>
                        <td>0 </td>
                        <td>; upper left </td>
                    </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td>Finally, to integrate this code with other
                virtual peripherals, keep in mind that it has a
                varying execution rate depending on the state and
                therefore should be placed after code with
                uniform execution rate.</td>
            </tr>
        </table>
        <p><!-- macro main_footer start --> </p>
        </td>
    </tr>
    <tr>
        <td width="112">&nbsp;</td>
        <td><hr>
        <div align="center"><center><table border="0">
            <tr>
                <td><a href="/company/index.html"><font size="1"
                face="Arial,Helvetica">[Company]</font></a></td>
                <td><a href="/products/index.html"><font size="1"
                face="Arial,Helvetica">[Products]</font></a></td>
                <td><a href="/tools/index.html"><font size="1"
                face="Arial,Helvetica">[Tools]</font></a></td>
                <td><a href="/virtual/index.html"><font size="1"
                face="Arial,Helvetica">[Peripherals]</font></a></td>
                <td><a href="/news/index.html"><font size="1"
                face="Arial,Helvetica">[News]</font></a></td>
                <td><a href="/support/index.html"><font size="1"
                face="Arial,Helvetica">[Support]</font></a></td>
                <td><a href="/partners/index.html"><font size="1"
                face="Arial,Helvetica">[Partners]</font></a></td>
                <td><a href="/sales/index.html"><font size="1"
                face="Arial,Helvetica">[Sales]</font></a></td>
                <td><a href="/jobs/index.html"><font size="1"
                face="Arial,Helvetica">[Jobs]</font></a></td>
                <td><a href="/search/index.html"><font size="1"
                face="Arial,Helvetica">[Search]</font></a></td>
            </tr>
        </table>
        </center></div><hr>
        <p><font size="2" face="Arial,Helvetica">Scenix
        Semiconductor, Inc.| 3160 De La Cruz Blvd., Ste. 200 |
        Santa Clara, CA 95054<br>
        Tel: 408.327.8888 | Fax: 408.327.8880 | Technical Support
        Hotline: 800.556.0225</font> </p>
        <hr>
        <p><font color="#006699" size="1" face="Arial,Helvetica">©
        </font><a href="/copyright.html"><font color="#006699"
        size="1" face="Arial,Helvetica">Copyright 1998</font></a><font
        color="#006699" size="1" face="Arial,Helvetica">, All
        Rights Reserved | </font><a href="mailto:info@scenix.com"><font
        color="#006699" size="1" face="Arial,Helvetica">info@scenix.com</font></a><font
        color="#006699" size="1" face="Arial,Helvetica"> | </font><a
        href="/feedback/index.html"><font color="#006699"
        size="1" face="Arial,Helvetica">Feedback</font></a> </p>
        </td>
    </tr>
</table>
<!-- macro main_footer stop --></body>
</html>
